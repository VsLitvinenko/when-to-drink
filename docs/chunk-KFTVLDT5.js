import{a as Fe,c as j}from"./chunk-6IGCFAUU.js";import{b as Pe,c as R,d as L,e as B,g as ke,h as Me}from"./chunk-OFTZOE6C.js";import{$a as re,Ba as te,Bb as z,C as c,D as E,E as C,Ea as U,Eb as ve,Fb as he,Ga as l,Ha as d,Hb as fe,Ib as ge,Jb as _e,M as r,Ma as ne,Ob as Ee,P as S,Pa as D,T as y,Ta as ie,Ub as Ce,Va as oe,Vb as V,Wb as be,Y as Z,Z as ee,_b as Ie,a as $,ba as u,bc as G,ca as a,cb as ae,cc as ye,da as s,e as A,ea as p,eb as O,f as Q,h as N,ia as w,ja as b,jb as T,ka as f,kb as se,l as J,lb as le,mb as de,n as M,nb as k,pb as pe,qb as me,s as K,sa as P,sb as ce,u as F,ua as x,v as X,va as v,vb as ue,w as q,wa as h,z as Y}from"./chunk-NOZYAWNI.js";import"./chunk-Q6FFIHTR.js";import"./chunk-7KGURMOZ.js";import"./chunk-NKG53MNX.js";import"./chunk-62TPDNO2.js";import"./chunk-7PWDY3UP.js";import"./chunk-JRYKI6H5.js";import"./chunk-GIIU5PV3.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-SPMQWSIB.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import"./chunk-2R6CW7ES.js";var H={Name:{en:"Event name",ru:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},Starts:{en:"Starts",ru:"\u041D\u0430\u0447\u0430\u043B\u043E"},Ends:{en:"Ends",ru:"\u041A\u043E\u043D\u0435\u0446"},Description:{en:"Description",ru:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"},NamePlaceholder:{en:"Enter name",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},DescriptionPlaceholder:{en:"Enter description",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"},CreateEvent:{en:"Create event",ru:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u0435"},UpdateEvent:{en:"Update event",ru:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u0435"},HasBeenSaved:{en:"All changes have been saved successfully",ru:"\u0412\u0441\u0435 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B"}};var we=(()=>{let n=class n{constructor(){this.baseUrl="events",this.http=c(re)}getEventInfo(e){return this.http.get(`${this.baseUrl}/info/${e}`)}createEvent(e){return this.http.post(this.baseUrl,e).pipe(N(t=>t.id))}updateEvent(e,t){return this.http.patch(`${this.baseUrl}/${e}`,t).pipe(N(o=>o.id))}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Y({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();var xe=()=>[0,1];function Ve(i,n){if(i&1&&(p(0,"ion-datetime",13),l(1,"async")),i&2){let m=f();u("firstDayOfWeek",1)("locale",d(1,2,m.localizeFormat$))}}function Ge(i,n){if(i&1&&(p(0,"ion-datetime",14),l(1,"async")),i&2){let m=f();u("firstDayOfWeek",1)("locale",d(1,2,m.localizeFormat$))}}function Le(i,n){i&1&&p(0,"ion-spinner",11)}function Be(i,n){if(i&1&&p(0,"ion-icon",12),i&2){let m=f();u("name",m.eventId()?"checkmark-outline":"add-outline")}}var De=(()=>{let n=class n{constructor(){this.eventId=D(),this.startVal=j(new Date,"yyyy-MM-dd"),this.endVal=j(Fe(new Date,1),"yyyy-MM-dd"),this.eventFormGroup=new de({name:new k("",T.required),starts:new k(this.startVal,T.required),ends:new k(this.endVal,T.required),description:new k("")}),this.startDate=R(this.eventFormGroup.controls.starts.valueChanges,{initialValue:this.startVal}),this.endDate=R(this.eventFormGroup.controls.ends.valueChanges,{initialValue:this.endVal}),this.isDatesInvalid=ne(()=>{let e=new Date(this.startDate()),t=new Date(this.endDate());return e>=t}),this.local=c(L),this.localizeFormat$=this.local.localizationWithFormat$,this.EditEventFormLocalize=H,this.router=c(O),this.activatedRoute=c(ae),this.toast=c(G),this.request=c(we),this.loading$=new $,this.eventInfo$=Pe(this.eventId).pipe(q(()=>this.eventFormGroup.disable()),F(e=>e?this.request.getEventInfo(e):Q(null)),q(()=>this.eventFormGroup.enable()),K(1)),this.destroyed$=new $}ngOnInit(){this.eventInfo$.pipe(J(e=>e!==null),X(this.destroyed$)).subscribe(e=>{this.eventFormGroup.patchValue({name:e.name,starts:e.starts,ends:e.ends,description:e.description})})}ngOnDestroy(){this.destroyed$.next(void 0),this.destroyed$.complete()}saveChanges(){let e=this.eventId(),t=this.eventFormGroup.getRawValue(),o=e?this.request.updateEvent(e,t):this.request.createEvent(t);this.eventFormGroup.disable(),o.pipe(M(1)).subscribe(g=>{this.eventFormGroup.enable();let _=this.local.localizeSync(H.HasBeenSaved);this.toast.info(_,"cloud-done-outline"),this.updateIdQueryParam(g)})}updateIdQueryParam(e){let t={queryParams:{eventId:e},relativeTo:this.activatedRoute,queryParamsHandling:"merge"};this.router.navigate([],t)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=S({type:n,selectors:[["app-edit-event-form"]],inputs:{eventId:[1,"eventId"]},decls:37,vars:37,consts:[["startDateModal",""],["endDateModal",""],["mode","ios",3,"formGroup"],["color","dark","slot","end","formControlName","name",3,"placeholder"],[3,"click"],["datetime","datetimeStart"],[1,"event-datetime-modal",3,"keepContentsMounted","initialBreakpoint","breakpoints"],["datetime","datetimeEnd"],["lines","none",1,"notes-item"],["color","dark","slot","end","formControlName","description",3,"autoGrow","placeholder"],["mode","ios","expand","block",1,"save-changes-button",3,"click","disabled"],["mode","ios","slot","start"],["slot","start",3,"name"],["id","datetimeStart","formControlName","starts","presentation","date","mode","ios",3,"firstDayOfWeek","locale"],["id","datetimeEnd","formControlName","ends","presentation","date","mode","ios",3,"firstDayOfWeek","locale"]],template:function(t,o){if(t&1){let g=w();te(0),l(1,"async"),a(2,"ion-list",2)(3,"ion-item")(4,"ion-label"),v(5),l(6,"localize"),s(),p(7,"ion-input",3),l(8,"localize"),s(),a(9,"ion-item",4),b("click",function(){E(g);let I=P(15);return C(I.present())}),a(10,"ion-label"),v(11),l(12,"localize"),s(),p(13,"ion-datetime-button",5),a(14,"ion-modal",6,0),y(16,Ve,2,4,"ng-template"),s()(),a(17,"ion-item",4),b("click",function(){E(g);let I=P(23);return C(I.present())}),a(18,"ion-label"),v(19),l(20,"localize"),s(),p(21,"ion-datetime-button",7),a(22,"ion-modal",6,1),y(24,Ge,2,4,"ng-template"),s()(),a(25,"ion-item",8)(26,"ion-label"),v(27),l(28,"localize"),s(),p(29,"ion-textarea",9),l(30,"localize"),s()(),a(31,"ion-button",10),b("click",function(){return E(g),C(o.saveChanges())}),Z(32,Le,1,0,"ion-spinner",11)(33,Be,1,1,"ion-icon",12),a(34,"ion-label"),v(35),l(36,"localize"),s()()}if(t&2){let g,_=o.eventFormGroup.disabled,I=((g=d(1,19,o.eventInfo$))==null?null:g.canEdit)!==!1;r(2),x("form-disabled",_),u("formGroup",o.eventFormGroup),r(3),h(" ",d(6,21,o.EditEventFormLocalize.Name)," "),r(2),u("placeholder",d(8,23,o.EditEventFormLocalize.NamePlaceholder)),r(4),h(" ",d(12,25,o.EditEventFormLocalize.Starts)," "),r(3),u("keepContentsMounted",!0)("initialBreakpoint",1)("breakpoints",U(35,xe)),r(5),h(" ",d(20,27,o.EditEventFormLocalize.Ends)," "),r(3),u("keepContentsMounted",!0)("initialBreakpoint",1)("breakpoints",U(36,xe)),r(5),h(" ",d(28,29,o.EditEventFormLocalize.Description)," "),r(2),u("autoGrow",!0)("placeholder",d(30,31,o.EditEventFormLocalize.DescriptionPlaceholder)),r(2),u("disabled",!I||_||o.eventFormGroup.invalid||o.isDatesInvalid()),r(),ee(_?32:33),r(3),h(" ",d(36,33,o.eventId()?o.EditEventFormLocalize.UpdateEvent:o.EditEventFormLocalize.CreateEvent)," ")}},dependencies:[Me,ge,z,V,_e,fe,oe,B,be,ue,Ce,he,Ie,Ee,ce,se,le,pe,me],styles:["ion-list[_ngcontent-%COMP%]{background:transparent}.form-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .form-disabled[_ngcontent-%COMP%]   ion-datetime-button[_ngcontent-%COMP%]{opacity:.5!important}ion-item[_ngcontent-%COMP%]{--background: transparent}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:1.25rem .5rem 1.25rem 0}ion-textarea[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%]{text-align:end;margin-right:.25rem;width:60%!important}.notes-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:auto}.notes-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{margin-top:.6rem}.save-changes-button[_ngcontent-%COMP%]{margin:.5rem 1rem}.save-changes-button[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-left:-.25rem;margin-inline-end:.5rem}.save-changes-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:1.75rem;height:1.75rem;margin-inline-end:.5rem}.save-changes-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{line-height:1.75rem}  .event-datetime-modal .ion-delegate-host{padding:.75rem .25rem 2.5rem!important;background-color:var(--ion-color-light, #f4f5f8)!important}"]});let i=n;return i})();var W={Link:{en:"Link",ru:"\u0421\u0441\u044B\u043B\u043A\u0430"},Share:{en:"Share",ru:"\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F"},GoTo:{en:"Go to",ru:"\u041F\u0435\u0440\u0435\u0439\u0442\u0438"},ClipboardLink:{en:"Link to event was copied to clipboard",ru:"\u0421\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0441\u043E\u0431\u044B\u0442\u0438\u0435 \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430"}};function $e(i,n){if(i&1){let m=w();a(0,"div",4)(1,"ion-button",5),b("click",function(){E(m);let t=f();return C(t.copyToClipboard())}),p(2,"ion-icon",6),a(3,"span"),v(4),l(5,"localize"),s()(),a(6,"ion-button",5),b("click",function(){E(m);let t=f();return C(t.share())}),p(7,"ion-icon",7),a(8,"span"),v(9),l(10,"localize"),s()(),a(11,"ion-button",5),b("click",function(){E(m);let t=f();return C(t.redirectToEvent())}),p(12,"ion-icon",8),a(13,"span"),v(14),l(15,"localize"),s()()()}if(i&2){let m=f(),e=P(2);x("disabled",e.eventFormGroup.disabled),r(4),h(" ",d(5,5,m.EditEventPageLocalize.Link)," "),r(5),h(" ",d(10,7,m.EditEventPageLocalize.Share)," "),r(5),h(" ",d(15,9,m.EditEventPageLocalize.GoTo)," ")}}var Ct=(()=>{let n=class n{constructor(){this.eventId=D(),this.router=c(O),this.toast=c(G),this.tg=c(ye),this.local=c(L),this.EditEventPageLocalize=W}copyToClipboard(){this.tg.getEventTgLink(this.eventId()).pipe(F(e=>A(navigator.clipboard.writeText(e))),M(1)).subscribe(()=>{let e=this.local.localizeSync(W.ClipboardLink);this.toast.light(e,"clipboard-outline")})}share(){this.eventId()&&this.tg.shareEvent(this.eventId())}redirectToEvent(){this.router.navigate(["vote",this.eventId()])}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=S({type:n,selectors:[["app-edit-event-page"]],hostAttrs:[1,"app-page-inner"],inputs:{eventId:[1,"eventId"]},decls:4,vars:2,consts:[["form",""],[1,"ion-padding"],[3,"eventId"],["class","done-actions",3,"disabled",4,"ngIf"],[1,"done-actions"],["mode","ios","size","small","color","light",3,"click"],["name","link-outline","slot","start"],["name","arrow-redo-outline","slot","start"],["name","arrow-forward","slot","end"]],template:function(t,o){t&1&&(a(0,"ion-content",1),p(1,"app-edit-event-form",2,0),y(3,$e,16,11,"div",3),s()),t&2&&(r(),u("eventId",o.eventId()),r(2),u("ngIf",o.eventId()))},dependencies:[ke,ie,ve,V,B,De,z],styles:[".done-actions[_ngcontent-%COMP%]{margin:.5rem .925rem;display:flex;flex-wrap:wrap;justify-content:space-between;gap:.5rem}.done-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex-grow:1;--padding-top: .6rem;--padding-bottom: .6rem;--border-radius: .75rem}.done-actions.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}"]});let i=n;return i})();export{Ct as EditEventPageComponent};
