import{a as Me,c as H}from"./chunk-6IGCFAUU.js";import{b as Pe,c as j,d as B,e as L,g as ke,h as Se}from"./chunk-567XOYJ6.js";import{Aa as te,Ab as T,B as c,C as _,D as C,Da as R,Db as ue,Eb as he,Fa as l,Ga as d,Gb as fe,Hb as ge,Ib as Ee,L as r,La as ie,Nb as _e,O as x,Oa as D,S as y,Sa as ne,Tb as Ce,Ua as oe,Ub as V,Vb as be,X as Z,Y as ee,Zb as Ie,_a as re,a as $,aa as v,ac as G,ba as a,bb as ae,bc as ye,ca as s,da as m,db as O,e as A,f as Q,g as N,ha as w,ia as b,ib as z,ja as f,jb as se,k as J,kb as le,lb as de,m as S,mb as k,ob as me,pb as pe,r as K,ra as P,rb as ce,t as M,ta as F,u as X,ua as u,ub as ve,v as q,va as h,y as Y}from"./chunk-3L6J7R6N.js";import"./chunk-Q6FFIHTR.js";import"./chunk-7KGURMOZ.js";import"./chunk-NKG53MNX.js";import"./chunk-62TPDNO2.js";import"./chunk-7PWDY3UP.js";import"./chunk-JRYKI6H5.js";import"./chunk-GIIU5PV3.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-SPMQWSIB.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import"./chunk-2R6CW7ES.js";var U={Name:{en:"Event name",ru:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},Starts:{en:"Starts",ru:"\u041D\u0430\u0447\u0430\u043B\u043E"},Ends:{en:"Ends",ru:"\u041A\u043E\u043D\u0435\u0446"},Description:{en:"Description",ru:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"},NamePlaceholder:{en:"Enter name",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},DescriptionPlaceholder:{en:"Enter description",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"},SaveEvent:{en:"Save event",ru:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u0435"},HasBeenSaved:{en:"All changes have been saved successfully",ru:"\u0412\u0441\u0435 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B"}};var we=(()=>{let i=class i{constructor(){this.baseUrl="events",this.http=c(re)}getEventInfo(e){return this.http.get(`${this.baseUrl}/info/${e}`)}createEvent(e){return this.http.post(this.baseUrl,e).pipe(N(t=>t.id))}updateEvent(e,t){return this.http.patch(`${this.baseUrl}/${e}`,t).pipe(N(o=>o.id))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=Y({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var Fe=()=>[0,1];function Ve(n,i){if(n&1&&(m(0,"ion-datetime",13),l(1,"async")),n&2){let p=f();v("firstDayOfWeek",1)("locale",d(1,2,p.localizeFormat$))}}function Ge(n,i){if(n&1&&(m(0,"ion-datetime",14),l(1,"async")),n&2){let p=f();v("firstDayOfWeek",1)("locale",d(1,2,p.localizeFormat$))}}function Be(n,i){n&1&&m(0,"ion-spinner",11)}function Le(n,i){if(n&1&&m(0,"ion-icon",12),n&2){let p=f();v("name",p.eventId()?"checkmark-outline":"add-outline")}}var De=(()=>{let i=class i{constructor(){this.eventId=D(),this.startVal=H(new Date,"yyyy-MM-dd"),this.endVal=H(Me(new Date,1),"yyyy-MM-dd"),this.eventFormGroup=new de({name:new k("",z.required),starts:new k(this.startVal,z.required),ends:new k(this.endVal,z.required),description:new k("")}),this.startDate=j(this.eventFormGroup.controls.starts.valueChanges,{initialValue:this.startVal}),this.endDate=j(this.eventFormGroup.controls.ends.valueChanges,{initialValue:this.endVal}),this.isDatesInvalid=ie(()=>{let e=new Date(this.startDate()),t=new Date(this.endDate());return e>=t}),this.local=c(B),this.localizeFormat$=this.local.localizationWithFormat$,this.EditEventFormLocalize=U,this.router=c(O),this.activatedRoute=c(ae),this.toast=c(G),this.request=c(we),this.loading$=new $,this.eventInfo$=Pe(this.eventId).pipe(q(()=>this.eventFormGroup.disable()),M(e=>e?this.request.getEventInfo(e):Q(null)),q(()=>this.eventFormGroup.enable()),K(1)),this.destroyed$=new $}ngOnInit(){this.eventInfo$.pipe(J(e=>e!==null),X(this.destroyed$)).subscribe(e=>{this.eventFormGroup.patchValue({name:e.name,starts:e.starts,ends:e.ends,description:e.description})})}ngOnDestroy(){this.destroyed$.next(void 0),this.destroyed$.complete()}saveChanges(){let e=this.eventId(),t=this.eventFormGroup.getRawValue(),o=e?this.request.updateEvent(e,t):this.request.createEvent(t);this.eventFormGroup.disable(),o.pipe(S(1)).subscribe(g=>{this.eventFormGroup.enable();let E=this.local.localizeSync(U.HasBeenSaved);this.toast.info(E,"cloud-done-outline"),this.updateIdQueryParam(g)})}updateIdQueryParam(e){let t={queryParams:{eventId:e},relativeTo:this.activatedRoute,queryParamsHandling:"merge"};this.router.navigate([],t)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=x({type:i,selectors:[["app-edit-event-form"]],inputs:{eventId:[1,"eventId"]},decls:37,vars:38,consts:[["startDateModal",""],["endDateModal",""],["mode","ios",3,"inset","formGroup"],["color","dark","slot","end","formControlName","name",3,"placeholder"],[3,"click"],["datetime","datetimeStart"],[1,"event-datetime-modal",3,"keepContentsMounted","initialBreakpoint","breakpoints"],["datetime","datetimeEnd"],["lines","none",1,"notes-item"],["color","dark","slot","end","formControlName","description",3,"autoGrow","placeholder"],["mode","ios","expand","block",1,"save-changes-button",3,"click","disabled"],["mode","ios","slot","start"],["slot","start",3,"name"],["id","datetimeStart","formControlName","starts","presentation","date","mode","ios",3,"firstDayOfWeek","locale"],["id","datetimeEnd","formControlName","ends","presentation","date","mode","ios",3,"firstDayOfWeek","locale"]],template:function(t,o){if(t&1){let g=w();te(0),l(1,"async"),a(2,"ion-list",2)(3,"ion-item")(4,"ion-label"),u(5),l(6,"localize"),s(),m(7,"ion-input",3),l(8,"localize"),s(),a(9,"ion-item",4),b("click",function(){_(g);let I=P(15);return C(I.present())}),a(10,"ion-label"),u(11),l(12,"localize"),s(),m(13,"ion-datetime-button",5),a(14,"ion-modal",6,0),y(16,Ve,2,4,"ng-template"),s()(),a(17,"ion-item",4),b("click",function(){_(g);let I=P(23);return C(I.present())}),a(18,"ion-label"),u(19),l(20,"localize"),s(),m(21,"ion-datetime-button",7),a(22,"ion-modal",6,1),y(24,Ge,2,4,"ng-template"),s()(),a(25,"ion-item",8)(26,"ion-label"),u(27),l(28,"localize"),s(),m(29,"ion-textarea",9),l(30,"localize"),s()(),a(31,"ion-button",10),b("click",function(){return _(g),C(o.saveChanges())}),Z(32,Be,1,0,"ion-spinner",11)(33,Le,1,1,"ion-icon",12),a(34,"ion-label"),u(35),l(36,"localize"),s()()}if(t&2){let g,E=o.eventFormGroup.disabled,I=((g=d(1,20,o.eventInfo$))==null?null:g.canEdit)!==!1;r(2),F("form-disabled",E),v("inset",!0)("formGroup",o.eventFormGroup),r(3),h(" ",d(6,22,o.EditEventFormLocalize.Name)," "),r(2),v("placeholder",d(8,24,o.EditEventFormLocalize.NamePlaceholder)),r(4),h(" ",d(12,26,o.EditEventFormLocalize.Starts)," "),r(3),v("keepContentsMounted",!0)("initialBreakpoint",1)("breakpoints",R(36,Fe)),r(5),h(" ",d(20,28,o.EditEventFormLocalize.Ends)," "),r(3),v("keepContentsMounted",!0)("initialBreakpoint",1)("breakpoints",R(37,Fe)),r(5),h(" ",d(28,30,o.EditEventFormLocalize.Description)," "),r(2),v("autoGrow",!0)("placeholder",d(30,32,o.EditEventFormLocalize.DescriptionPlaceholder)),r(2),v("disabled",!I||E||o.eventFormGroup.invalid||o.isDatesInvalid()),r(),ee(E?32:33),r(3),h(" ",d(36,34,o.EditEventFormLocalize.SaveEvent)," ")}},dependencies:[Se,ge,T,V,Ee,fe,oe,L,be,ve,Ce,he,Ie,_e,ce,se,le,me,pe],styles:["ion-list[_ngcontent-%COMP%]{padding:.5rem .25rem .75rem;background:var(--ion-color-light, #f4f5f8)}.form-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .form-disabled[_ngcontent-%COMP%]   ion-datetime-button[_ngcontent-%COMP%]{opacity:.5!important}ion-item[_ngcontent-%COMP%]{--background: transparent}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:1.25rem .5rem 1.25rem 0}ion-textarea[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%]{text-align:end;margin-right:.25rem;width:60%!important}.notes-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:auto}.notes-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{margin-top:.6rem}.save-changes-button[_ngcontent-%COMP%]{margin:.5rem 1rem}.save-changes-button[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-left:-.25rem;margin-inline-end:.5rem}.save-changes-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:1.75rem;height:1.75rem;margin-inline-end:.5rem}.save-changes-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{line-height:1.75rem}  .event-datetime-modal{--max-width: 600px;--height: auto !important}  .event-datetime-modal .ion-delegate-host{padding:1.5rem 1.75rem 2rem!important;background-color:var(--ion-color-light, #f4f5f8)!important}  .event-datetime-modal ion-datetime{width:100%!important}"]});let n=i;return n})();var W={CreateEvent:{en:"Create event",ru:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u0435"},EditEvent:{en:"Edit event",ru:"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u0435"},Link:{en:"Link",ru:"\u0421\u0441\u044B\u043B\u043A\u0430"},Share:{en:"Share",ru:"\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F"},GoTo:{en:"Go to",ru:"\u041F\u0435\u0440\u0435\u0439\u0442\u0438"},ClipboardLink:{en:"Link to event was copied to clipboard",ru:"\u0421\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0441\u043E\u0431\u044B\u0442\u0438\u0435 \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430"}};function $e(n,i){if(n&1){let p=w();a(0,"div",5)(1,"ion-button",6),b("click",function(){_(p);let t=f();return C(t.copyToClipboard())}),m(2,"ion-icon",7),a(3,"span"),u(4),l(5,"localize"),s()(),a(6,"ion-button",6),b("click",function(){_(p);let t=f();return C(t.share())}),m(7,"ion-icon",8),a(8,"span"),u(9),l(10,"localize"),s()(),a(11,"ion-button",6),b("click",function(){_(p);let t=f();return C(t.redirectToEvent())}),m(12,"ion-icon",9),a(13,"span"),u(14),l(15,"localize"),s()()()}if(n&2){let p=f(),e=P(5);F("disabled",e.eventFormGroup.disabled),r(4),h(" ",d(5,5,p.EditEventPageLocalize.Link)," "),r(5),h(" ",d(10,7,p.EditEventPageLocalize.Share)," "),r(5),h(" ",d(15,9,p.EditEventPageLocalize.GoTo)," ")}}var Ct=(()=>{let i=class i{constructor(){this.eventId=D(),this.router=c(O),this.toast=c(G),this.tg=c(ye),this.local=c(B),this.EditEventPageLocalize=W}copyToClipboard(){this.tg.getEventTgLink(this.eventId()).pipe(M(e=>A(navigator.clipboard.writeText(e))),S(1)).subscribe(()=>{let e=this.local.localizeSync(W.ClipboardLink);this.toast.light(e,"clipboard-outline")})}share(){this.eventId()&&this.tg.shareEvent(this.eventId())}redirectToEvent(){this.router.navigate(["vote",this.eventId()])}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=x({type:i,selectors:[["app-edit-event-page"]],hostAttrs:[1,"app-page-inner"],inputs:{eventId:[1,"eventId"]},decls:7,vars:5,consts:[["form",""],[1,"ion-padding"],[1,"title"],[3,"eventId"],["class","done-actions",3,"disabled",4,"ngIf"],[1,"done-actions"],["mode","ios","size","small","color","light",3,"click"],["name","link-outline","slot","start"],["name","arrow-redo-outline","slot","start"],["name","arrow-forward","slot","end"]],template:function(t,o){t&1&&(a(0,"ion-content",1)(1,"h3",2),u(2),l(3,"localize"),s(),m(4,"app-edit-event-form",3,0),y(6,$e,16,11,"div",4),s()),t&2&&(r(2),h(" ",d(3,3,o.eventId()?o.EditEventPageLocalize.EditEvent:o.EditEventPageLocalize.CreateEvent)," "),r(2),v("eventId",o.eventId()),r(2),v("ngIf",o.eventId()))},dependencies:[ke,ne,ue,V,L,De,T],styles:[".title[_ngcontent-%COMP%]{margin-left:1.25rem;margin-bottom:1rem}.done-actions[_ngcontent-%COMP%]{margin:.925rem;display:flex;flex-wrap:wrap;justify-content:space-between;gap:.5rem}.done-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex-grow:1;--padding-top: .6rem;--padding-bottom: .6rem;--border-radius: .75rem}.done-actions.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}"]});let n=i;return n})();export{Ct as EditEventPageComponent};
