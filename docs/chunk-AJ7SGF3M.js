import{b as ai,c as F}from"./chunk-6IGCFAUU.js";import{a as bt,b as de,c as mt,d as ue,e as B,f as fe,g as ri,h as z}from"./chunk-VZHNHBTU.js";import{c as vt,d as ct,e as yt,g as He,h as Ct,i as We}from"./chunk-46S35REE.js";import{$ as ke,$a as Oe,Aa as ae,Ab as Re,Ba as gt,Bb as Be,C as y,Ca as _t,Cb as Qt,D as b,Da as Ee,Db as st,E as x,Ea as K,Eb as Yt,Fa as Ke,Ga as p,Ha as f,Hb as J,I as T,Ia as O,Ib as R,J as ne,Ja as Nt,Jb as ce,Ka as jt,Kb as pe,L as Ie,Lb as Gt,M as s,Ma as j,Mb as Jt,Na as Ne,Nb as Xt,Oa as je,P as I,Pa as k,Pb as lt,Qa as Le,R as Y,Sa as Ht,T as A,Ta as Ze,Tb as Kt,U as Vt,Ua as Wt,Ub as me,Va as G,Vb as H,W as Et,Wa as se,Xa as et,Xb as Zt,Y as U,Yb as ei,Z as N,Zb as ti,_ as Se,a as Q,aa as Pe,ac as ii,b as Dt,ba as u,bc as pt,c as De,ca as a,cc as ni,da as l,e as wt,ea as v,eb as qt,ec as oi,fa as Lt,g as It,ga as Ot,h as D,ha as Rt,i as ee,ia as S,j as St,ja as C,k as q,ka as h,kb as tt,l as kt,la as Bt,ma as zt,n as Ue,na as Ft,o as Je,oa as $t,ob as it,p as te,pa as At,qa as Te,r as Pt,ra as Ve,rb as nt,s as Ce,sa as M,t as ie,ta as Ut,u as V,ua as Xe,v as be,va as d,vb as le,w,wa as g,wb as ot,x as Tt,xa as $,xb as rt,ya as oe,yb as at,z as we,za as re}from"./chunk-U2AWJU55.js";import"./chunk-Q6FFIHTR.js";import"./chunk-7KGURMOZ.js";import"./chunk-NKG53MNX.js";import"./chunk-62TPDNO2.js";import"./chunk-7PWDY3UP.js";import"./chunk-JRYKI6H5.js";import"./chunk-GIIU5PV3.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-SPMQWSIB.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as W,b as X,f as ht}from"./chunk-2R6CW7ES.js";var si={Search:{en:"Search",ru:"\u041F\u043E\u0438\u0441\u043A"}};var ze=(()=>{let i=class i{set src(e){e?(this.img.src=e,this.showPlaceholder()):this.img.src=this.imgPlaceholder}get img(){return this.elRef.nativeElement}constructor(){this.imgPlaceholder="/assets/no-avatar.png",this.elRef=y(ne),this.placeholderEl=this.createPlaceholderEl(),this.img.onload=()=>this.hidePlaceholder()}showPlaceholder(){let e=this.placeholderEl;e.style.width=`${this.img.width+2}px`,e.style.height=`${this.img.offsetHeight+2}px`,e.style.top=`${this.img.offsetTop-1}px`,e.style.left=`${this.img.offsetLeft-1}px`,e.style.borderRadius=window.getComputedStyle(this.img).getPropertyValue("border-radius"),this.img.after(this.placeholderEl)}hidePlaceholder(){this.placeholderEl.remove()}createPlaceholderEl(){let e=document.createElement("div");return e.style.zIndex="1",e.style.position="absolute",e.className="skeleton-placeholder",e}};i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=Y({type:i,selectors:[["","appImgLoad",""]],inputs:{src:"src",imgPlaceholder:"imgPlaceholder"}});let o=i;return o})();var he=(()=>{let i=class i{set placeholderOpacity(e){this.placeholderEl.style.opacity=e}get el(){return this.elRef.nativeElement}constructor(){this.elRef=y(ne),this.placeholderEl=this.createPlaceholderEl(),this.loadingCounter$=new Dt(0),this.loading$=this.loadingCounter$.pipe(D(e=>e>0),Je()),this.destroyed$=new Q}ngOnInit(){this.el.style.position="relative",this.loading$.pipe(be(this.destroyed$)).subscribe(e=>e?this.onLoadStarts():this.onLoadEnds())}ngOnDestroy(){this.destroyed$.next(void 0),this.destroyed$.complete()}incrLoading(){this.loadingCounter$.next(this.loadingCounter$.value+1)}decrLoading(){this.loadingCounter$.next(this.loadingCounter$.value-1)}onLoadStarts(){this.el.appendChild(this.placeholderEl)}onLoadEnds(){this.placeholderEl.remove()}createPlaceholderEl(){let e=document.createElement("div");return e.style.zIndex="2",e.style.position="absolute",e.style.top="0",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.pointerEvents="none",e.style.borderRadius="0.5rem",e.className="skeleton-placeholder",e}};i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=Y({type:i,selectors:[["","appFeatureLoad",""]],inputs:{placeholderOpacity:"placeholderOpacity"},exportAs:["appFeatureLoad"]});let o=i;return o})();var Pi=["end"],Ti=(o,i)=>({$implicit:o,index:i});function Vi(o,i){if(o&1&&Rt(0,6),o&2){let r=h(),e=r.$implicit,t=r.$index,n=h();u("ngTemplateOutlet",n.endTemplateRef)("ngTemplateOutletContext",Ke(2,Ti,e,t))}}function Ei(o,i){if(o&1){let r=S();a(0,"ion-item",3),C("click",function(){let t=b(r),n=t.$implicit,c=t.$index,m=h();return x(m.onUserClicked(c,n))}),a(1,"ion-avatar",4),v(2,"img",5),l(),a(3,"ion-label"),d(4),l(),U(5,Vi,1,5,"ng-container",6),l()}if(o&2){let r=i.$implicit,e=i.$index,t=i.$count,n=h();u("lines",e===t-1?"none":"")("button",n.clickable()),s(2),u("src",r.photoUrl,Ie),s(2),g(" ",r.fullName," "),s(),N(n.endTemplateRef?5:-1)}}var dt=(()=>{let i=class i{constructor(){this.clickable=k(!1),this.users=k.required(),this.searchStr=T(null),this.filteredUsers=j(()=>{let e=this.users(),t=this.searchStr()?.toLowerCase();return t?e.filter(n=>n.fullName.toLowerCase().includes(t)):e}),this.searchFocused=je(),this.userClicked=je(),this.UsersListLocalize=si}onUserClicked(e,t){this.clickable()&&this.userClicked.emit({index:e,user:W({},t)})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-users-list"]],contentQueries:function(t,n,c){if(t&1&&Ft(c,Pi,7),t&2){let m;$t(m=At())&&(n.endTemplateRef=m.first)}},inputs:{clickable:[1,"clickable"],users:[1,"users"]},outputs:{searchFocused:"searchFocused",userClicked:"userClicked"},decls:5,vars:4,consts:[["mode","ios","clear-icon","close-outline",3,"ionInput","ionFocus","ionBlur","debounce","placeholder"],["mode","ios"],[3,"lines","button"],[3,"click","lines","button"],["slot","start"],["appImgLoad","",3,"src"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,n){t&1&&(a(0,"ion-searchbar",0),p(1,"localize"),C("ionInput",function(m){return n.searchStr.set(m.detail.value)})("ionFocus",function(){return n.searchFocused.emit(!0)})("ionBlur",function(){return n.searchFocused.emit(!1)}),l(),a(2,"ion-list",1),ke(3,Ei,6,5,"ion-item",2,Se),l()),t&2&&(u("debounce",300)("placeholder",f(1,2,n.UsersListLocalize.Search)),s(3),Pe(n.filteredUsers()))},dependencies:[et,Wt,B,ce,J,Re,R,ei,ze],styles:["[_nghost-%COMP%]{height:100%;position:relative}ion-searchbar[_ngcontent-%COMP%]{position:sticky;top:0}ion-list[_ngcontent-%COMP%]{background:transparent;max-height:calc(100% - 3.75rem);overflow-y:auto}ion-item[_ngcontent-%COMP%]{--background: transparent}"]});let o=i;return o})();function Li(o,i){if(o&1&&(a(0,"ion-avatar"),v(1,"img",1),l()),o&2){let r=i.$implicit,e=i.$index,t=i.$count;Ut("z-index",t-e),s(),u("src",r.photoUrl,Ie)}}var li=(()=>{let i=class i{constructor(){this.users=k.required(),this.maxCount=k(8),this.sliced=j(()=>this.users().slice(0,this.maxCount()))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-avatars-list"]],inputs:{users:[1,"users"],maxCount:[1,"maxCount"]},decls:2,vars:0,consts:[[3,"zIndex"],["appImgLoad","","alt","",3,"src"]],template:function(t,n){t&1&&ke(0,Li,2,3,"ion-avatar",0,Se),t&2&&Pe(n.sliced())},dependencies:[et,Re,ze],styles:["[_nghost-%COMP%]{display:flex}ion-avatar[_ngcontent-%COMP%]{width:1.6rem;height:1.6rem}ion-avatar[_ngcontent-%COMP%]:not(:last-child){margin-right:-.7rem}"]});let o=i;return o})();var Fe={Member:{en:"member",ru:"\u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A"},Initiator:{en:"Initiator",ru:"\u0418\u043D\u0438\u0446\u0438\u0430\u0442\u043E\u0440"},Starts:{en:"Starts",ru:"\u041D\u0430\u0447\u0430\u043B\u043E"},Ends:{en:"Ends",ru:"\u041A\u043E\u043D\u0435\u0446"},Description:{en:"Description",ru:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"},Share:{en:"Share",ru:"\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F"},Link:{en:"Link",ru:"\u0421\u0441\u044B\u043B\u043A\u0430"},Edit:{en:"Edit",ru:"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C"},Delete:{en:"Delete",ru:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"},ClipboardLink:{en:"Link was copied to clipboard",ru:"\u0421\u0441\u044B\u043B\u043A\u0430 \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430"},EventWasDeleted:{en:"Event was successfully deleted",ru:"\u0421\u043E\u0431\u044B\u0442\u0438\u0435 \u0431\u044B\u043B\u043E \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u043E"},DeleteQuestion:{en:"Delete event?",ru:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u0435?"},CannotBeUndone:{en:"This cannot be undone",ru:"\u042D\u0442\u043E \u043D\u0435\u043B\u044C\u0437\u044F \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C"}};var ci=(()=>{let i=class i{constructor(){this.baseUrl="events",this.http=y(Oe)}getEventInfo(e){return this.http.get(`${this.baseUrl}/${e}`)}deleteEvent(e){return this.http.delete(`${this.baseUrl}/${e}`)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=we({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Oi=()=>[0,1],pi=()=>[];function Ri(o,i){if(o&1){let r=S();a(0,"ion-item",15),C("click",function(){b(r);let t=h(2);return x(t.redirectToEdit())}),v(1,"ion-icon",18),a(2,"ion-label"),d(3),p(4,"localize"),l()(),a(5,"ion-item",15),C("click",function(){b(r);let t=h(2);return x(t.deleteEvent())}),v(6,"ion-icon",19),a(7,"ion-label",20),d(8),p(9,"localize"),l()()}if(o&2){let r=h(2);u("detail",!1),s(3),g(" ",f(4,4,r.EventMainInfoLocalize.Edit)," "),s(2),u("detail",!1),s(3),g(" ",f(9,6,r.EventMainInfoLocalize.Delete)," ")}}function Bi(o,i){if(o&1){let r=S();a(0,"ion-list",14)(1,"ion-item",15),C("click",function(){b(r);let t=h();return x(t.share())}),v(2,"ion-icon",16),a(3,"ion-label"),d(4),p(5,"localize"),l()(),a(6,"ion-item",15),C("click",function(){b(r);let t=h();return x(t.copyToClipboard())}),v(7,"ion-icon",17),a(8,"ion-label"),d(9),p(10,"localize"),l()(),U(11,Ri,10,8),p(12,"async"),l()}if(o&2){let r=h(),e=Ee(0);s(),u("detail",!1),s(3),g(" ",f(5,5,r.EventMainInfoLocalize.Share)," "),s(2),u("detail",!1),s(3),g(" ",f(10,7,r.EventMainInfoLocalize.Link)," "),s(2),N(f(12,9,r.tgUserId$)===(e==null||e.creator==null?null:e.creator.tgId)?11:-1)}}function zi(o,i){if(o&1){let r=S();a(0,"ion-item",15),C("click",function(){b(r),h();let t=M(37);return x(t.present())}),a(1,"ion-label"),d(2),p(3,"localizeMany"),l(),v(4,"app-avatars-list",21),l()}if(o&2){let r=h(),e=Ee(0),t=Ee(13);u("detail",!1),s(2),$(" ",t," ",O(3,4,r.EventMainInfoLocalize.Member,t)," "),s(2),u("users",(e==null?null:e.users)??K(7,pi))}}function Fi(o,i){if(o&1&&(a(0,"ion-item",12)(1,"ion-label"),d(2),p(3,"localize"),l(),a(4,"ion-note"),d(5),l()()),o&2){let r=h(),e=Ee(0);s(2),g(" ",f(3,2,r.EventMainInfoLocalize.Description)," "),s(3),g(" ",e==null?null:e.description," ")}}function $i(o,i){if(o&1){let r=S();a(0,"app-users-list",22),C("searchFocused",function(t){b(r),h();let n=M(37);return x(n.backdropDismiss=!t)}),l()}if(o&2){h();let r=Ee(0);u("users",(r==null?null:r.users)??K(1,pi))}}var ut=(()=>{let i=class i{constructor(){this.eventId=k.required(),this.eventId$=de(this.eventId),this.router=y(qt),this.toast=y(pt),this.confirm=y(oi),this.tg=y(ni),this.request=y(ci),this.featureLoad=y(he,{optional:!0}),this.refreshInfo$=new Q,this.info$=this.refreshInfo$.pipe(ie(!0),V(()=>this.eventId$),w(()=>this.featureLoad?.incrLoading()),V(e=>this.request.getEventInfo(e).pipe(te(()=>this.featureLoad?.decrLoading()))),Ce(1)),this.info=mt(this.info$),this.tgUserId$=this.tg.userId$,this.local=y(ue),this.EventMainInfoLocalize=Fe}refresh(){this.refreshInfo$.next(!0)}copyToClipboard(){this.tg.getEventTgLink(this.eventId()).pipe(V(e=>wt(navigator.clipboard.writeText(e))),Ue(1)).subscribe(()=>{let e=this.local.localizeSync(Fe.ClipboardLink);this.toast.light(e,"clipboard-outline")})}share(){this.eventId()&&this.tg.shareEvent(this.eventId(),this.info()?.name)}redirectToEdit(){let e={eventId:this.eventId()};this.router.navigate(["edit"],{queryParams:e})}deleteEvent(){let e=this.local.localizeSync(Fe.DeleteQuestion),t=this.local.localizeSync(Fe.CannotBeUndone),n=this.local.localizeSync(Fe.EventWasDeleted);this.confirm.createConfirm({header:e,message:t}).pipe(kt(Boolean),w(()=>this.featureLoad?.incrLoading()),V(()=>this.request.deleteEvent(this.eventId())),w(()=>this.toast.info(n,"trash-outline")),te(()=>this.featureLoad?.decrLoading())).subscribe(()=>this.router.navigate(["edit"]))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-event-main-info"]],inputs:{eventId:[1,"eventId"]},decls:39,vars:29,consts:[["usersModal",""],["mode","ios"],["value","info"],["slot","header",1,"header-item"],["slot","start"],["appImgLoad","",3,"src"],["id","menu-popover-trigger","slot","end","color","dark","fill","clear","size","large",1,"menu-button",3,"click"],["name","ellipsis-vertical","slot","icon-only"],["mode","ios","trigger","menu-popover-trigger","triggerAction","click",3,"dismissOnSelect","arrow"],["slot","content","mode","ios",1,"info-list"],["button","",3,"detail"],[3,"lines"],["lines","none",1,"notes-item"],[3,"initialBreakpoint","breakpoints"],["lines","none",1,"popover-menu-list"],["button","",3,"click","detail"],["name","share-social-outline","slot","start","color","medium"],["name","link-outline","slot","start","color","medium"],["name","create-outline","slot","start","color","medium"],["name","trash-outline","slot","start","color","danger"],["color","danger"],[3,"users"],[3,"searchFocused","users"]],template:function(t,n){if(t&1){let c=S();gt(0),a(1,"ion-accordion-group",1)(2,"ion-accordion",2)(3,"ion-item",3)(4,"ion-avatar",4),v(5,"img",5),l(),a(6,"ion-label"),d(7),l(),a(8,"ion-button",6),C("click",function(_){return b(c),x(_.stopPropagation())}),v(9,"ion-icon",7),l(),a(10,"ion-popover",8),A(11,Bi,13,11,"ng-template"),l()(),a(12,"ion-list",9),gt(13),U(14,zi,5,8,"ion-item",10),a(15,"ion-item")(16,"ion-label"),d(17),p(18,"localize"),l(),a(19,"ion-note"),d(20," Vyacheslav Litvinenko "),l()(),a(21,"ion-item")(22,"ion-label"),d(23),p(24,"localize"),l(),a(25,"ion-note"),d(26),p(27,"date"),l()(),a(28,"ion-item",11)(29,"ion-label"),d(30),p(31,"localize"),l(),a(32,"ion-note"),d(33),p(34,"date"),l()(),U(35,Fi,6,4,"ion-item",12),l()()(),a(36,"ion-modal",13,0),A(38,$i,1,2,"ng-template"),l()}if(t&2){let c=_t(n.info());s(5),u("src",c==null||c.creator==null?null:c.creator.photoUrl,Ie),s(2),g(" ",(c==null?null:c.name)??"Event name"," "),s(3),u("dismissOnSelect",!0)("arrow",!1),s(3);let m=_t((c==null||c.users==null?null:c.users.length)??0);s(),N(m>0?14:-1),s(3),g(" ",f(18,16,n.EventMainInfoLocalize.Initiator)," "),s(6),g(" ",f(24,18,n.EventMainInfoLocalize.Starts)," "),s(3),g(" ",O(27,20,c==null?null:c.starts,"dd.MM.yyyy")," "),s(2),u("lines",c!=null&&c.description?"":"none"),s(2),g(" ",f(31,23,n.EventMainInfoLocalize.Ends)," "),s(3),g(" ",O(34,25,c==null?null:c.ends,"dd.MM.yyyy")," "),s(2),N(c!=null&&c.description?35:-1),s(),u("initialBreakpoint",1)("breakpoints",K(28,Oi))}},dependencies:[z,R,Be,H,ce,J,pe,G,se,B,fe,at,rt,Re,le,ot,li,dt,ze],styles:["ion-accordion-group[_ngcontent-%COMP%]{border-radius:.5rem}ion-list.info-list[_ngcontent-%COMP%]{margin-top:.5rem;background:transparent}ion-item[_ngcontent-%COMP%]{--background: transparent}ion-item.header-item[_ngcontent-%COMP%]{border-radius:.5rem;--padding-start: .75rem;--min-height: 3.7rem}ion-item.header-item[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:2.75rem!important;height:2.75rem!important}ion-item.header-item[_ngcontent-%COMP%]   .menu-button[_ngcontent-%COMP%]{margin-right:-1rem}ion-item.header-item[_ngcontent-%COMP%]   .menu-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.25rem}ion-item.header-item[_ngcontent-%COMP%]     .ion-accordion-toggle-icon{position:absolute;right:3rem}ion-item.notes-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:auto}ion-item.notes-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{padding:.5rem 0;margin-left:max(20%,2.5rem);text-align:end}ion-popover[_ngcontent-%COMP%]{--offset-y: -.25rem;--offset-x: -.6rem;--width: auto}ion-popover[_ngcontent-%COMP%]   .popover-menu-list[_ngcontent-%COMP%]{padding:.25rem 0;background-color:var(--ion-background-color-step-100);white-space:nowrap}app-avatars-list[_ngcontent-%COMP%]{opacity:.9}ion-modal[_ngcontent-%COMP%]{--height: auto}ion-modal[_ngcontent-%COMP%]   app-users-list[_ngcontent-%COMP%]{height:60vh;padding:1rem}"]});let o=i;return o})();var mi={FilterResults:{en:"Filter results",ru:"\u0424\u0438\u043B\u044C\u0442\u0440\u043E\u0432\u0430\u0442\u044C \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u044B"},Consider:{en:"Consider",ru:"\u0423\u0447\u0438\u0442\u044B\u0432\u0430\u0442\u044C"},Maybe:{en:'"maybe"',ru:'"\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E"'},Time:{en:'"time"',ru:'"\u0432\u0440\u0435\u043C\u044F"'},IgnorePastDates:{en:"Ignore past dates",ru:"\u0423\u0431\u0440\u0430\u0442\u044C \u043F\u0440\u043E\u0448\u0435\u0434\u0448\u0438\u0435 \u0434\u0430\u0442\u044B"},AtLeast:{en:"At least",ru:"\u041A\u0430\u043A \u043C\u0438\u043D\u0438\u043C\u0443\u043C"},Member:{en:"member",ru:"\u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A"}};var di=ht(bt());var ui=(()=>{let i=class i{set maxOverlap(e){(0,di.isNil)(e)||this.membersCount.set(e)}constructor(){this.disabled=!1,this.maybe=T(!0),this.time=T(!0),this.trimPast=T(!0),this.membersCount=T(1),this.ResultFiltersLocalize=mi}ngOnInit(){}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-result-filters"]],inputs:{disabled:"disabled",maxMembers:"maxMembers",maxOverlap:"maxOverlap"},decls:34,vars:36,consts:[["mode","ios"],["value","filters","toggleIcon","remove-outline"],["slot","header",1,"header-item"],["slot","content","mode","ios"],[3,"ngModelChange","ngModel"],["color","warning"],["color","success"],["lines","none"],["lines","none",1,"range-list-item"],[3,"ngModelChange","ngModel","snaps","min","max","ticks"]],template:function(t,n){t&1&&(a(0,"ion-accordion-group",0)(1,"ion-accordion",1)(2,"ion-item",2)(3,"ion-label"),d(4),p(5,"localize"),l()(),a(6,"ion-list",3)(7,"ion-item")(8,"ion-checkbox",4),ae("ngModelChange",function(m){return re(n.maybe,m)||(n.maybe=m),m}),d(9),p(10,"localize"),a(11,"ion-text",5),d(12),p(13,"localize"),l()()(),a(14,"ion-item")(15,"ion-checkbox",4),ae("ngModelChange",function(m){return re(n.time,m)||(n.time=m),m}),d(16),p(17,"localize"),a(18,"ion-text",6),d(19),p(20,"localize"),l()()(),a(21,"ion-item")(22,"ion-checkbox",4),ae("ngModelChange",function(m){return re(n.trimPast,m)||(n.trimPast=m),m}),d(23),p(24,"localize"),l()(),a(25,"ion-item",7)(26,"ion-label"),d(27),p(28,"localize"),l(),a(29,"ion-note"),d(30),p(31,"localizeMany"),l()(),a(32,"ion-item",8)(33,"ion-range",9),ae("ngModelChange",function(m){return re(n.membersCount,m)||(n.membersCount=m),m}),l()()()()()),t&2&&(Xe("disabled",n.disabled),s(4),g(" ",f(5,19,n.ResultFiltersLocalize.FilterResults)," "),s(4),oe("ngModel",n.maybe),s(),g(" ",f(10,21,n.ResultFiltersLocalize.Consider)," "),s(3),g(" ",f(13,23,n.ResultFiltersLocalize.Maybe)," "),s(3),oe("ngModel",n.time),s(),g(" ",f(17,25,n.ResultFiltersLocalize.Consider)," "),s(3),g(" ",f(20,27,n.ResultFiltersLocalize.Time)," "),s(3),oe("ngModel",n.trimPast),s(),g(" ",f(24,29,n.ResultFiltersLocalize.IgnorePastDates)," "),s(4),g(" ",f(28,31,n.ResultFiltersLocalize.AtLeast)," "),s(3),$(" ",n.membersCount()," ",O(31,33,n.ResultFiltersLocalize.Member,n.membersCount())," "),s(3),oe("ngModel",n.membersCount),u("snaps",!0)("min",1)("max",n.maxMembers)("ticks",n.maxMembers<=10))},dependencies:[z,R,ce,J,pe,lt,B,fe,at,rt,Kt,Zt,nt,tt,it],styles:[".disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}ion-accordion[_ngcontent-%COMP%]{background:var(--ion-color-light, #f4f5f8);border-radius:.5rem;--padding-end: 0}.header-item[_ngcontent-%COMP%]{--inner-padding-end: .9rem}ion-list[_ngcontent-%COMP%]{background:var(--ion-color-light, #f4f5f8)}ion-item[_ngcontent-%COMP%]{--background: transparent}ion-item[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{opacity:.85}ion-item[_ngcontent-%COMP%]   ion-range[_ngcontent-%COMP%]{--knob-size: 22px}ion-item.range-list-item[_ngcontent-%COMP%]{margin-top:-.65rem;--padding-start: 1px;--inner-padding-end: .2rem}"]});let o=i;return o})();var fi=(o,i=500)=>{let r=ee(o,"touchstart"),e=ee(o,"touchend"),t=ee(o,"touchmove");return r.pipe(V(n=>St(i).pipe(D(()=>n),be(q(e,t)))),w(()=>It(e).then(n=>n.preventDefault())))};var ge=class{static get dayFormat(){return"yyyy-MM-dd"}static get timeFormat(){return"yyyy-MM-dd'T'HH:mm:ss"}static toJsDates(i){return X(W({},i),{date:new Date(i.date),start:i.start?new Date(i.start):void 0,end:i.end?new Date(i.end):void 0})}static toStringDates(i){return X(W({},i),{date:F(i.date,this.dayFormat),start:i.start?F(i.start,this.timeFormat):void 0,end:i.end?F(i.end,this.timeFormat):void 0})}};var P=function(o){return o.Ready="ready",o.Maybe="maybe",o.Time="time",o}(P||{});var hi=ht(bt());var Ui="rgba(var(--ion-color-base-rgb), 0.2)",Qe=o=>F(o,"yyyy-MM-dd"),gi=(()=>{let i=class i{set voteDates(e){let t=(0,hi.groupBy)(e,"voteType"),n=t[P.Ready]??[],c=t[P.Maybe]??[],m=t[P.Time]??[];this.readyDates.set(new Set(n.map(_=>Qe(_.date)))),this.maybeDates.set(new Set(c.map(_=>Qe(_.date)))),this.timeDates.set(new Map(m.map(_=>[Qe(_.date),_])))}get voteDates(){let e=this.readyDates(),t=this.maybeDates(),n=this.timeDates();return[...Array.from(e).map(c=>({date:new Date(c),voteType:P.Ready})),...Array.from(t).map(c=>({date:new Date(c),voteType:P.Maybe})),...Array.from(n.values())]}get rootEl(){return this.elRef.nativeElement.shadowRoot}constructor(){this.readyDates=T(new Set),this.maybeDates=T(new Set),this.timeDates=T(new Map),this.lastFocusedDateButton$=new De(1),this.focusedTimeChanges=this.lastFocusedDateButton$.pipe(D(e=>{if(!e)return;let t=Number(e.getAttribute("data-day")),n=Number(e.getAttribute("data-month")),c=Number(e.getAttribute("data-year")),m=new Date(c,n-1,t);return this.timeDates().get(Qe(m))})),this.ionDateComponent=y(me),this.elRef=y(ne),this.rootObs=new MutationObserver(()=>{let e=this.rootEl.querySelectorAll("button.calendar-day");this.dateButtons$.next(Array.from(e))}),this.dateButtons$=new De(1),this.destroyed$=new De(1),Ne(()=>{let e=this.readyDates();this.ionDateComponent.value=Array.from(e)}),Ne(()=>{let e=this.maybeDates(),t=this.timeDates();this.ionDateComponent.highlightedDates=[...Array.from(e).map(n=>({date:n,textColor:"var(--maybe-text-color)",backgroundColor:"var(--maybe-bg-color)"})),...Array.from(t.keys()).map(n=>({date:n,textColor:"var(--time-text-color)",backgroundColor:"var(--time-bg-color)"}))]})}ngAfterViewInit(){this.rootObs.observe(this.rootEl,{childList:!0,subtree:!0}),this.dateButtons$.pipe(w(e=>e.forEach(t=>{t.style.boxShadow="none",t.style.fontWeight="400",t.style.fontSize="1.25rem"})),V(e=>{let t=e.map(n=>{let c=ee(n,"contextmenu"),m=fi(n);return q(c,m).pipe(w(_=>_.preventDefault()),D(_=>X(W({},_),{target:n})),Tt(500))});return q(...t)}),be(this.destroyed$)).subscribe(e=>this.showPopover(e)),this.ionDateComponent.ionChange.pipe(be(this.destroyed$)).subscribe(e=>{this.readyDates().clear(),e.detail.value?.forEach(n=>{this.readyDates().add(n),this.maybeDates().delete(n),this.timeDates().delete(n)}),this.emitAllDatesSignals()})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this.dateButtons$.complete(),this.rootObs.disconnect()}showPopover(e){let t=e.target;this.popover.present(e);let n=t.style.backgroundColor??"";this.popover.willPresent.pipe(Ue(1)).subscribe(()=>{this.lastFocusedDateButton$.next(t),t.style.backgroundColor=Ui}),this.popover.willDismiss.pipe(Ue(1)).subscribe(c=>{if(this.lastFocusedDateButton$.next(void 0),t.style.backgroundColor=n,c.detail.data){let m=Number(t.getAttribute("data-day")),_=Number(t.getAttribute("data-month")),L=Number(t.getAttribute("data-year"));this.handlePopoverButtons(c.detail.data,L,_,m)}})}handlePopoverButtons(e,t,n,c){let m=new Date(t,n-1,c),_=Qe(m);if(e.ready)this.readyDates().add(_),this.maybeDates().delete(_),this.timeDates().delete(_);else if(e.maybe)this.maybeDates().add(_),this.readyDates().delete(_),this.timeDates().delete(_);else if(e.time){let L=new Date(e.start),Ae=new Date(e.end);L.setFullYear(t,n-1,c),Ae.setFullYear(t,n-1,c);let Ge={date:m,voteType:P.Time,start:L,end:Ae};this.timeDates().set(_,Ge),this.readyDates().delete(_),this.maybeDates().delete(_)}this.emitAllDatesSignals()}emitAllDatesSignals(){this.readyDates.set(new Set(this.readyDates())),this.maybeDates.set(new Set(this.maybeDates())),this.timeDates.set(new Map(this.timeDates()))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=Y({type:i,selectors:[["","appIonDateSpecify",""]],inputs:{popover:"popover",voteDates:"voteDates"},outputs:{focusedTimeChanges:"focusedTimeChanges"},exportAs:["appIonDateSpecify"]});let o=i;return o})();var Mt={Ready:{en:"Ready",ru:"\u0413\u043E\u0442\u043E\u0432"},Maybe:{en:"Maybe",ru:"\u0412\u043E\u0437\u043C\u043E\u0436\u043D\u043E"},Time:{en:"Time",ru:"\u0412\u0440\u0435\u043C\u044F"},HoldDate:{en:"Hold date",ru:"\u0423\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0439\u0442\u0435 \u0434\u0430\u0442\u0443,"},RightClickDate:{en:"Right click on date",ru:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u043F\u0440\u0430\u0432\u043E\u0439 \u043A\u043D\u043E\u043F\u043A\u043E\u0439 \u043C\u044B\u0448\u0438 \u043F\u043E \u0434\u0430\u0442\u0435,"},SelectSpecificStatus:{en:"to select specific status",ru:"\u0447\u0442\u043E\u0431\u044B \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441"},DoNotForgetSave:{en:"Don't forget to save changes",ru:"\u041D\u0435 \u0437\u0430\u0431\u0443\u0434\u044C\u0442\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F"},Clear:{en:"Clear",ru:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C"},Cancel:{en:"Cancel",ru:"\u041E\u0442\u043C\u0435\u043D\u0430"},Save:{en:"Save",ru:"\u0413\u043E\u0442\u043E\u0432\u043E"},StartTime:{en:"Start time",ru:"\u0412\u0440\u0435\u043C\u044F \u043D\u0430\u0447\u0430\u043B\u0430"},EndTime:{en:"End time",ru:"\u0412\u0440\u0435\u043C\u044F \u043E\u043A\u043E\u043D\u0447\u0430\u043D\u0438\u044F"},SpecifyTime:{en:"Specify time",ru:"\u0423\u043A\u0430\u0437\u0430\u0442\u044C \u0432\u0440\u0435\u043C\u044F"},HasBeenSaved:{en:"All changes have been saved successfully",ru:"\u0412\u0441\u0435 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B"}};var _i=(()=>{let i=class i{constructor(){this.baseUrl="votes",this.http=y(Oe)}getEventVote(e){let t={eventId:e};return this.http.get(this.baseUrl,{params:t}).pipe(D(n=>n.dates),D(n=>n.map(c=>ge.toJsDates(c))))}updateEventVote(e,t){let c={dates:t.map(_=>ge.toStringDates(_))},m={eventId:e};return this.http.post(this.baseUrl,c,{params:m}).pipe(D(_=>_.dates),D(_=>_.map(L=>ge.toJsDates(L))))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=we({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Ni=()=>[],ji=()=>[0,1];function Hi(o,i){if(o&1){let r=S();a(0,"div",24)(1,"ion-button",25,3),C("click",function(){b(r),h();let t=M(41);return x(t.dismiss({ready:!0}))}),v(3,"ion-icon",26),l(),a(4,"ion-button",27,4),C("click",function(){b(r),h();let t=M(41);return x(t.dismiss({maybe:!0}))}),v(6,"ion-icon",28),l(),a(7,"ion-button",29,5),C("click",function(){b(r),h();let t=M(44);return x(t.present())}),v(9,"ion-icon",30),l()()}}function Wi(o,i){if(o&1){let r=S();a(0,"div",31)(1,"div",32)(2,"div",33)(3,"ion-label"),d(4),p(5,"localize"),l(),a(6,"ion-datetime",34),ae("ngModelChange",function(t){b(r);let n=h();return re(n.startTime,t)||(n.startTime=t),x(t)}),l()(),a(7,"div",33)(8,"ion-label"),d(9),p(10,"localize"),l(),a(11,"ion-datetime",34),ae("ngModelChange",function(t){b(r);let n=h();return re(n.endTime,t)||(n.endTime=t),x(t)}),l()()(),a(12,"ion-button",35),C("click",function(){b(r);let t=h(),n=M(41);return M(44).dismiss(),x(n.dismiss({time:!0,start:t.startTime(),end:t.endTime()}))}),d(13),p(14,"localize"),l()()}if(o&2){let r=h();s(4),g(" ",f(5,6,r.VoteCalendarLocalize.StartTime)," "),s(2),oe("ngModel",r.startTime),s(3),g(" ",f(10,8,r.VoteCalendarLocalize.EndTime)," "),s(2),oe("ngModel",r.endTime),s(),u("disabled",r.isTimeInvalid()),s(),g(" ",f(14,10,r.VoteCalendarLocalize.SpecifyTime)," ")}}var Ye="yyyy-MM-dd'T'HH:mm:ss",vi=(()=>{let i=class i{constructor(){this.eventId=k.required(),this.minDate=k(),this.maxDate=k(),this.voteUpdated=je(),this.resetDates$=new Q,this.clearDates$=new Q,this.saveDates$=new Q,this.request=y(_i),this.featureLoad=y(he,{optional:!0}),this.loadedVoteDates$=de(this.eventId).pipe(w(()=>this.featureLoad?.incrLoading()),V(e=>this.request.getEventVote(e).pipe(te(()=>this.featureLoad?.decrLoading()))),Ce(1)),this.updatedVoteDates$=this.saveDates$.pipe(w(()=>this.featureLoad?.incrLoading()),V(e=>this.request.updateEventVote(this.eventId(),e).pipe(te(()=>this.featureLoad?.decrLoading()))),w(()=>{let e=this.loc.localizeSync(Mt.HasBeenSaved);this.toast.info(e,"cloud-done-outline")}),w(()=>this.voteUpdated.emit()),Ce(1)),this.voteDates$=q(this.resetDates$.pipe(ie(!0),V(()=>q(this.loadedVoteDates$,this.updatedVoteDates$)),D(e=>e.slice())),this.clearDates$.pipe(D(()=>[]))),this.startTime=T(F(new Date,Ye)),this.endTime=T(F(new Date,Ye)),this.isTimeInvalid=j(()=>{let e=new Date(this.startTime()),t=new Date(this.endTime());return e>=t}),this.toast=y(pt),this.tools=y(ii),this.isTouchDevice=this.tools.isTouchDevice,this.loc=y(ue),this.localizeFormat$=this.loc.localizationWithFormat$,this.VoteCalendarLocalize=Mt}updateTime(e){let t=F(new Date,Ye),n=e?.start?F(e.start,Ye):t,c=e?.end?F(e.end,Ye):t;this.startTime.set(n),this.endTime.set(c)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-vote-calendar"]],inputs:{eventId:[1,"eventId"],minDate:[1,"minDate"],maxDate:[1,"maxDate"]},outputs:{voteUpdated:"voteUpdated"},decls:46,vars:43,consts:[["appIonDateSpecify","appIonDateSpecify"],["popover",""],["timeModal",""],["readyButton",""],["maybeButton",""],["timeButton",""],[1,"vote-calendar"],[1,"vote-calendar-header"],[1,"chips"],["color","primary",1,"ion-activated"],["name","checkmark-outline"],["color","warning",1,"ion-activated"],["name","help-outline"],["color","success",1,"ion-activated"],["name","time-outline"],[1,"subtitle"],["appIonDateSpecify","","presentation","date","mode","ios",3,"focusedTimeChanges","voteDates","popover","multiple","firstDayOfWeek","min","max","locale"],["mode","ios",1,"vote-calendar-actions"],["color","medium",3,"click"],[1,"right"],["color","danger",3,"click"],["color","primary",3,"click"],["mode","ios","side","top","alignment","center",3,"arrow"],[3,"initialBreakpoint","breakpoints"],[1,"popover-content"],["size","small","color","primary",3,"click"],["name","checkmark-outline","slot","icon-only"],["size","small","color","warning",3,"click"],["name","help-outline","slot","icon-only"],["size","small","color","success",3,"click"],["name","time-outline","slot","icon-only"],[1,"time-modal-content"],[1,"time-pickers"],[1,"pick"],["presentation","time","mode","ios",3,"ngModelChange","ngModel"],["mode","ios",3,"click","disabled"]],template:function(t,n){if(t&1){let c=S();a(0,"div",6)(1,"div",7)(2,"div",8)(3,"ion-chip",9),v(4,"ion-icon",10),a(5,"ion-label"),d(6),p(7,"localize"),l()(),a(8,"ion-chip",11),v(9,"ion-icon",12),a(10,"ion-label"),d(11),p(12,"localize"),l()(),a(13,"ion-chip",13),v(14,"ion-icon",14),a(15,"ion-label"),d(16),p(17,"localize"),l()()(),a(18,"span",15),d(19),p(20,"localize"),p(21,"localize"),v(22,"br"),d(23),p(24,"localize"),l()(),a(25,"ion-datetime",16,0),p(27,"async"),p(28,"async"),C("focusedTimeChanges",function(_){return b(c),x(n.updateTime(_))}),l(),a(29,"ion-buttons",17)(30,"ion-button",18),C("click",function(){return b(c),x(n.clearDates$.next(!0))}),d(31),p(32,"localize"),l(),a(33,"div",19)(34,"ion-button",20),C("click",function(){return b(c),x(n.resetDates$.next(!0))}),d(35),p(36,"localize"),l(),a(37,"ion-button",21),C("click",function(){b(c);let _=M(26);return x(n.saveDates$.next(_.voteDates))}),d(38),p(39,"localize"),l()()()(),a(40,"ion-popover",22,1),A(42,Hi,10,0,"ng-template"),l(),a(43,"ion-modal",23,2),A(45,Wi,15,12,"ng-template"),l()}if(t&2){let c=M(41);s(6),g(" ",f(7,19,n.VoteCalendarLocalize.Ready)," "),s(5),g(" ",f(12,21,n.VoteCalendarLocalize.Maybe)," "),s(5),g(" ",f(17,23,n.VoteCalendarLocalize.Time)," "),s(3),$(" ",f(20,25,n.isTouchDevice?n.VoteCalendarLocalize.HoldDate:n.VoteCalendarLocalize.RightClickDate)," ",f(21,27,n.VoteCalendarLocalize.SelectSpecificStatus)," "),s(4),g(" ",f(24,29,n.VoteCalendarLocalize.DoNotForgetSave)," "),s(2),u("voteDates",f(27,31,n.voteDates$)??K(41,Ni))("popover",c)("multiple",!0)("firstDayOfWeek",1)("min",n.minDate()??void 0)("max",n.maxDate()??void 0)("locale",f(28,33,n.localizeFormat$)),s(6),g(" ",f(32,35,n.VoteCalendarLocalize.Clear)," "),s(4),g(" ",f(36,37,n.VoteCalendarLocalize.Cancel)," "),s(3),g(" ",f(39,39,n.VoteCalendarLocalize.Save)," "),s(2),u("arrow",!0),s(3),u("initialBreakpoint",1)("breakpoints",K(42,ji))}},dependencies:[z,R,Be,Qt,H,G,B,gi,me,st,ot,le,nt,tt,it],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;height:100%}.vote-calendar-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;background-color:var(--ion-color-light, #f4f5f8);padding:.5rem .5rem .25rem;border-top-left-radius:.5rem;border-top-right-radius:.5rem}.vote-calendar-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{padding:0 .5rem;color:var(--ion-text-color-step-600, #b3b3b3);font-size:.9rem;line-height:1.25rem;margin-top:.125rem;margin-bottom:1rem}.vote-calendar-header[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{display:flex;padding:0 .2rem;justify-content:space-between;gap:.25rem}.vote-calendar-header[_ngcontent-%COMP%]   .ion-activated[_ngcontent-%COMP%]{pointer-events:none}.vote-calendar-actions[_ngcontent-%COMP%]{padding:.5rem .75rem;background-color:var(--ion-color-light, #f4f5f8);justify-content:space-between;border-bottom-left-radius:.5rem;border-bottom-right-radius:.5rem;gap:1rem}.vote-calendar-actions[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;gap:.5rem}ion-datetime[_ngcontent-%COMP%]{border-radius:0}ion-popover[_ngcontent-%COMP%]{--offset-y: -.15rem;--width: 8rem}.popover-content[_ngcontent-%COMP%]{padding:.5rem;width:100%;display:flex;justify-content:space-between;gap:.25rem;opacity:.95}ion-modal[_ngcontent-%COMP%]{--height: auto}.time-modal-content[_ngcontent-%COMP%]{padding:1.5rem;display:flex;flex-direction:column;gap:1rem}.time-modal-content[_ngcontent-%COMP%]   .time-pickers[_ngcontent-%COMP%]{display:flex;gap:1rem}.time-modal-content[_ngcontent-%COMP%]   .time-pickers[_ngcontent-%COMP%]   .pick[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;align-items:center;gap:1rem}.time-modal-content[_ngcontent-%COMP%]   .time-pickers[_ngcontent-%COMP%]   .pick[_ngcontent-%COMP%]   ion-datetime[_ngcontent-%COMP%]{width:100%;border-radius:1rem}"]});let o=i;return o})();var Z=function(o){return o.List="list",o.Calendar="calendar",o}(Z||{});var yi=(()=>{let i=class i{constructor(){this.disabled=!1,this.ViewPick=Z,this.value=T(Z.List),this.refresh=new Vt}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-result-view-picker-control"]],inputs:{disabled:"disabled"},outputs:{refresh:"refresh"},decls:7,vars:3,consts:[[1,"picker",3,"ngClass"],[1,"item",3,"click"],["name","list-outline"],["name","calendar-outline"],[3,"click"],["slot","icon-only","name","refresh-outline"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1),C("click",function(){return n.value.set(n.ViewPick.List)}),v(2,"ion-icon",2),l(),a(3,"div",1),C("click",function(){return n.value.set(n.ViewPick.Calendar)}),v(4,"ion-icon",3),l()(),a(5,"ion-button",4),C("click",function(){return n.refresh.emit()}),v(6,"ion-icon",5),l()),t&2&&(Xe("disabled",n.disabled),u("ngClass",n.value()))},dependencies:[z,Ht,Be,H],styles:['[_nghost-%COMP%]{display:flex;justify-content:space-between;align-items:center}.picker[_ngcontent-%COMP%]{position:relative;display:flex;border-radius:.5rem;background-color:var(--ion-color-light, #f4f5f8);--border-size: 2px}.picker.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.picker[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{z-index:2;padding:.8rem 1.25rem;display:flex;align-items:center;cursor:pointer}.picker[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover{opacity:.7}.picker[_ngcontent-%COMP%]:after{content:"";transition:left .2s ease-in-out;z-index:1;position:absolute;top:var(--border-size);bottom:var(--border-size);width:calc(50% - var(--border-size) * 2);box-shadow:var(--picker-box-shadow);background-color:var(--ion-background-color-step-350, #fff);border-radius:.5rem}.picker.list[_ngcontent-%COMP%]:after{left:var(--border-size)!important}.picker.calendar[_ngcontent-%COMP%]:after{left:calc(50% + var(--border-size))!important}ion-button[_ngcontent-%COMP%]{margin:0;--border-radius: .5rem;--padding-bottom: .75rem;--padding-end: .75rem;--padding-start: .75rem;--padding-top: .75rem}']});let o=i;return o})();var qi=["*"],Qi=(o,i)=>({value:o,params:i}),Ci="0.4s ease-in-out",Yi={transform:"translateX(0)"},Gi={transform:"translateX({{ leaveEnd }}%)"},Ji={transform:"translateX({{ enterStart }}%)"},bi=(()=>{let i=class i{constructor(){this.viewPick=k.required(),this.animationDisabled=T(!0),this.animationParams=j(()=>{switch(this.viewPick()){case Z.List:return{leaveEnd:120,enterStart:-120};case Z.Calendar:return{leaveEnd:-120,enterStart:120};default:return{}}}),Et(()=>{this.animationDisabled()&&this.animationDisabled.set(!1)})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-result-view-picker-container"]],inputs:{viewPick:[1,"viewPick"]},ngContentSelectors:qi,decls:2,vars:5,consts:[[1,"result-view-picker-container-animated"]],template:function(t,n){t&1&&(Bt(),a(0,"div",0),zt(1),l()),t&2&&u("@.disabled",n.animationDisabled())("@openCloseResultView",Ke(2,Qi,n.viewPick(),n.animationParams()))},styles:[".result-view-picker-container-animated[_ngcontent-%COMP%]{display:grid;overflow:hidden;place-items:start}  .result-view-picker-container-animated>*{display:block;grid-column:1;grid-row:1;width:100%}"],data:{animation:[vt("openCloseResultView",[Ct("* => *",[yt([We(":enter",He(Ji)),We(":leave",[ct(Ci,He(Gi))],{optional:!0}),We(":enter",[ct(Ci),He(Yi)])])],{params:{leaveEnd:-120,enterStart:120}})])]},changeDetection:0});let o=i;return o})();var xi=(()=>{let i=class i{constructor(){this.baseUrl="results",this.http=y(Oe)}getEventResults(e){let t={eventId:e};return this.http.get(this.baseUrl,{params:t}).pipe(D(n=>{let c=n.dates.map(m=>ge.toJsDates(m));return X(W({},n),{dates:c})}))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=we({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Xi=ai(new Date),_e=(()=>{let i=class i{constructor(){this.eventId=k.required(),this.min=k.required(),this.maybe=k.required(),this.time=k.required(),this.trimPast=k.required(),this.request=y(xi),this.featureLoad=y(he,{optional:!0}),this.refresh$=new Q,this.eventid$=de(this.eventId),this.info$=this.refresh$.pipe(ie(!0),V(()=>this.eventid$),w(()=>this.featureLoad?.incrLoading()),V(e=>this.request.getEventResults(e).pipe(te(()=>this.featureLoad?.decrLoading()))),Ce(1)),this.info=mt(this.info$),this.dates=j(()=>this.info()?.dates??[]),this.filteredDates=j(()=>this.dates().filter(e=>e.users.length>=this.min()&&(!this.trimPast()||e.date>=Xi)&&(this.maybe()||e.voteType!==P.Maybe)&&(this.time()||e.voteType!==P.Time))),this.filteredDatesMap=j(()=>{let e=this.filteredDates();return new Map(e.map(t=>[this.formatVoteDate(t.date),t]))})}refresh(){this.refresh$.next(!0)}formatVoteDate(e){return F(e,"yyyy-MM-dd")}getVoteDate(e){let t=this.formatVoteDate(e);return this.filteredDatesMap().get(t)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=Y({type:i,selectors:[["","appResultView",""]],inputs:{eventId:[1,"eventId"],min:[1,"min"],maybe:[1,"maybe"],time:[1,"time"],trimPast:[1,"trimPast"]},exportAs:["appResultView"]});let o=i;return o})();var Di=ht(bt());var ve=class{static getColorByType(i){switch(i){case P.Ready:return"primary";case P.Maybe:return"warning";case P.Time:return"success"}}static getIconByType(i){switch(i){case P.Ready:return"checkmark-outline";case P.Maybe:return"help-outline";case P.Time:return"time-outline"}}};var $e={Member:{en:"member",ru:"\u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A"},NoData:{en:"No data, try to change filters",ru:"\u041F\u0443\u0441\u0442\u043E, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0434\u0440\u0443\u0433\u0438\u0435 \u0444\u0438\u043B\u044C\u0442\u0440\u044B"},NoTimeOverlap:{en:"No time overlap",ru:"\u041D\u0435\u0442 \u043E\u0431\u0449\u0435\u0433\u043E \u0432\u0440\u0435\u043C\u0435\u043D\u0438"}};var Ki=()=>[0,1];function Zi(o,i){if(o&1&&(Lt(0),a(1,"h3"),d(2),p(3,"date"),l(),Ot()),o&2){let r=i.ngIf,e=h(3);s(2),g(" ",Nt(3,1,e.resultDate.date,r.dateFormat,void 0,r.localize)," ")}}function en(o,i){if(o&1&&(a(0,"ion-chip",5),v(1,"ion-icon",8),a(2,"ion-label"),d(3),p(4,"localize"),l()()),o&2){let r=h(3);s(3),g(" ",f(4,1,r.ResultViewLocalize.NoTimeOverlap)," ")}}function tn(o,i){if(o&1&&(a(0,"ion-chip",6),v(1,"ion-icon",9),a(2,"ion-label"),d(3),p(4,"date"),p(5,"date"),l()()),o&2){let r=h(3);u("color",r.Helpers.getColorByType(r.resultDate.voteType)),s(),u("name",r.Helpers.getIconByType(r.resultDate.voteType)),s(2),$(" ",r.resultDate.start?O(4,4,r.resultDate.start,"HH:mm"):"00:00"," - ",r.resultDate.end?O(5,7,r.resultDate.end,"HH:mm"):"23:59"," ")}}function nn(o,i){if(o&1&&(a(0,"ion-text",10),d(1),p(2,"date"),p(3,"date"),l()),o&2){let r=h().$implicit,e=h(3);u("color",e.Helpers.getColorByType(r.voteType)),s(),$(" ",r.start?O(2,3,r.start,"HH:mm"):"00:00"," - ",r.end?O(3,6,r.end,"HH:mm"):"23:59"," ")}}function on(o,i){if(o&1&&v(0,"ion-icon",11),o&2){let r=h().$implicit,e=h(3);u("color",e.Helpers.getColorByType(r.voteType))("icon",e.Helpers.getIconByType(r.voteType))}}function rn(o,i){if(o&1&&U(0,nn,4,9,"ion-text",10)(1,on,1,2,"ion-icon",11),o&2){let r=i.$implicit,e=h(3);N(e.timeModeIndexes.has(r.index)?0:1)}}function an(o,i){if(o&1){let r=S();a(0,"div",3),A(1,Zi,4,6,"ng-container",4),p(2,"async"),U(3,en,5,3,"ion-chip",5)(4,tn,6,10,"ion-chip",6),l(),a(5,"app-users-list",7),C("userClicked",function(t){b(r);let n=h(2);return x(n.toggleUserMode(t.user))})("searchFocused",function(t){b(r),h(2);let n=M(1);return x(n.backdropDismiss=!t)}),A(6,rn,2,1,"ng-template",null,1,jt),l()}if(o&2){let r=h(2);s(),u("ngIf",f(2,4,r.dateFormat$)),s(2),N(r.resultDate.noTimeOverlap?3:4),s(2),u("users",r.resultDate.users)("clickable",!0)}}function sn(o,i){if(o&1&&U(0,an,8,6),o&2){let r=h();N(r.resultDate?0:-1)}}var ft=(()=>{let i=class i{constructor(){this.ionModal=Le(le),this.timeModeIndexes=new Set,this.Helpers=ve,this.localizeService=y(ue),this.ResultViewLocalize=$e,this.dateFormat$=this.localizeService.localizeLongDateFormat$}present(e){let t=this.ionModal();t&&(this.resultDate=e,e.users=e.users.map((n,c)=>X(W({},n),{index:c})),t.present())}clearData(){this.resultDate=void 0,this.timeModeIndexes=new Set}toggleUserMode(e){let t=e.index;this.timeModeIndexes.has(t)?this.timeModeIndexes.delete(t):this.timeModeIndexes.add(t)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-result-date-info-modal"]],viewQuery:function(t,n){t&1&&Te(n.ionModal,le,5),t&2&&Ve()},decls:3,vars:3,consts:[["modal",""],["end",""],[3,"ionModalDidDismiss","initialBreakpoint","breakpoints"],[1,"header"],[4,"ngIf"],["color","danger"],[1,"ion-activated",3,"color"],[3,"userClicked","searchFocused","users","clickable"],["name","alert-circle-outline"],[3,"name"],[1,"user-time-info",3,"color"],[3,"color","icon"]],template:function(t,n){if(t&1){let c=S();a(0,"ion-modal",2,0),C("ionModalDidDismiss",function(){return b(c),x(n.clearData())}),A(2,sn,1,1,"ng-template"),l()}t&2&&u("initialBreakpoint",1)("breakpoints",K(2,Ki))},dependencies:[z,Ze,R,H,lt,G,se,B,dt,le,st],styles:["ion-modal[_ngcontent-%COMP%]{--height: auto}ion-modal[_ngcontent-%COMP%]   app-users-list[_ngcontent-%COMP%]{height:52vh;padding:0 1rem 1rem}.header[_ngcontent-%COMP%]{padding:2rem 2rem .5rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;column-gap:.5rem;row-gap:.25rem}.header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.header[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{pointer-events:none;margin:0}.user-time-info[_ngcontent-%COMP%]{font-size:.8rem;margin-bottom:-1px}"]});let o=i;return o})();var Mi=(()=>{let i=class i{get rootEl(){return this.elRef.nativeElement.shadowRoot}constructor(){this.data=y(_e),this.elRef=y(ne),this.rootObs=new MutationObserver(()=>{let e=this.rootEl.querySelectorAll("button.calendar-day");this.dateButtons$.next(Array.from(e))}),this.dateButtons$=new De(1),this.voteDateSelected$=this.dateButtons$.pipe(w(e=>e.forEach(t=>{t.style.boxShadow="none",t.style.fontWeight="400",t.style.fontSize="1.25rem"})),V(e=>{let t=e.map(n=>ee(n,"click",{capture:!0}).pipe(w(c=>c.stopPropagation()),D(()=>n)));return q(...t)}),Je((e,t)=>!this.noActionsAfterReset&&e===t),D(e=>this.getDateSelectedEvent(e)),D(e=>e.voteDate?e:void 0),ie(void 0),Pt(),w(([e,t])=>this.handleButtonStyles(e,t)),D(([e,t])=>t?.voteDate),w(()=>this.noActionsAfterReset=!1)),this.noActionsAfterReset=!0,this.dateSelected=q(this.voteDateSelected$,this.getResetDateEvent(this.dateButtons$),this.getResetDateEvent(de(this.data.filteredDates)))}ngAfterViewInit(){this.rootObs.observe(this.rootEl,{childList:!0,subtree:!0})}ngOnDestroy(){this.dateButtons$.complete(),this.rootObs.disconnect()}getResetDateEvent(e){return e.pipe(w(()=>this.noActionsAfterReset=!0),D(()=>{}))}getDateSelectedEvent(e){let t=Number(e.getAttribute("data-day")),n=Number(e.getAttribute("data-month")),c=Number(e.getAttribute("data-year")),m=new Date(c,n-1,t);return{prevBgColor:e.style.backgroundColor,prevColor:e.style.color,voteDate:this.data.getVoteDate(m),buttonEl:e}}handleButtonStyles(e,t){if(e&&!this.noActionsAfterReset){let n=e.buttonEl;n.style.backgroundColor=e.prevBgColor,n.style.color=e.prevColor}if(t){let n=t.buttonEl;n.style.backgroundColor=n.style.color,n.style.color="var(--ion-color-contrast)"}}};i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=Y({type:i,selectors:[["","appResultViewCalendarPicker",""]],outputs:{dateSelected:"dateSelected"}});let o=i;return o})();function ln(o,i){if(o&1){let r=S();a(0,"div",4)(1,"ion-item",5),C("click",function(){let t=b(r).ngIf;h();let n=M(6);return x(n.present(t))}),v(2,"ion-icon",6),a(3,"ion-label"),d(4),p(5,"date"),l(),a(6,"ion-note",7),d(7),p(8,"localizeMany"),l()()()}if(o&2){let r=i.ngIf,e=h();s(2),u("color",r.noTimeOverlap?"danger":e.Helpers.getColorByType(r.voteType))("name",e.Helpers.getIconByType(r.voteType)),s(2),g(" ",O(5,5,r.date,"dd.MM.yyyy")," "),s(3),$(" ",r.users.length," ",O(8,8,e.ResultViewLocalize.Member,r.users.length)," ")}}var wi=(()=>{let i=class i{constructor(){this.ionDateComponent=Le(me),this.data=y(_e),this.Helpers=ve,this.ResultViewLocalize=$e,this.selectedDate=T(void 0),this.localizeService=y(ue),this.localizeFormat$=this.localizeService.localizationWithFormat$,Ne(()=>{let e=this.ionDateComponent(),t=this.data.filteredDates();if(e)if(t.length===0){e.highlightedDates=[];return}else{let n=(0,Di.groupBy)(t,"voteType"),c=n[P.Ready]??[],m=n[P.Maybe]??[],_=n[P.Time]??[];e.highlightedDates=[...c.map(L=>({date:this.data.formatVoteDate(L.date),textColor:"var(--ready-text-color)",backgroundColor:"var(--ready-bg-color)"})),...m.map(L=>({date:this.data.formatVoteDate(L.date),textColor:"var(--maybe-text-color)",backgroundColor:"var(--maybe-bg-color)"})),..._.map(L=>({date:this.data.formatVoteDate(L.date),textColor:"var(--time-text-color)",backgroundColor:"var(--time-bg-color)"}))]}else return})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-result-view-calendar"]],viewQuery:function(t,n){t&1&&Te(n.ionDateComponent,me,5),t&2&&Ve()},decls:7,vars:5,consts:[["infoModal",""],[1,"calendar-header"],["appResultViewCalendarPicker","","presentation","date","mode","ios",3,"dateSelected","firstDayOfWeek","locale"],["class","calendar-footer",4,"ngIf"],[1,"calendar-footer"],["button","","lines","none",3,"click"],["slot","start",3,"color","name"],["slot","end"]],template:function(t,n){if(t&1){let c=S();a(0,"div"),v(1,"div",1),a(2,"ion-datetime",2),p(3,"async"),C("dateSelected",function(_){return b(c),x(n.selectedDate.set(_))}),l(),A(4,ln,9,11,"div",3),l(),v(5,"app-result-date-info-modal",null,0)}t&2&&(s(2),u("firstDayOfWeek",1)("locale",f(3,3,n.localizeFormat$)),s(2),u("ngIf",n.selectedDate()))},dependencies:[z,Ze,R,H,J,pe,G,se,fe,me,ft,Mi],styles:[".calendar-header[_ngcontent-%COMP%]{background-color:var(--ion-color-light, #f4f5f8);border-top-left-radius:.5rem;border-top-right-radius:.5rem;width:100%;height:.5rem}ion-datetime[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:.5rem;border-bottom-right-radius:.5rem}.calendar-footer[_ngcontent-%COMP%]{background-color:var(--ion-color-light, #f4f5f8);border-bottom-left-radius:.5rem;border-bottom-right-radius:.5rem;padding-bottom:.25rem}.calendar-footer[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent}"],changeDetection:0});let o=i;return o})();function cn(o,i){if(o&1){let r=S();a(0,"ion-item",4),C("click",function(){let t=b(r).$implicit;h();let n=M(5);return x(n.present(t))}),v(1,"ion-icon",5),a(2,"ion-label"),d(3),p(4,"date"),l(),a(5,"ion-note",6),d(6),p(7,"localizeMany"),l()()}if(o&2){let r=i.$implicit,e=i.$index,t=i.$count,n=h();u("lines",e===t-1?"none":""),s(),u("color",r.noTimeOverlap?"danger":n.Helpers.getColorByType(r.voteType))("name",n.Helpers.getIconByType(r.voteType)),s(2),g(" ",O(4,6,r.date,"dd.MM.yyyy")," "),s(3),$(" ",r.users.length," ",O(7,9,n.ResultViewLocalize.Member,r.users.length)," ")}}function pn(o,i){if(o&1&&(a(0,"ion-item",3),v(1,"ion-icon",7),a(2,"ion-note",8),d(3),p(4,"localize"),l()()),o&2){let r=h();s(3),g(" ",f(4,1,r.ResultViewLocalize.NoData)," ")}}var Ii=(()=>{let i=class i{constructor(){this.data=y(_e),this.filteredDates=this.data.filteredDates,this.Helpers=ve,this.ResultViewLocalize=$e}ngOnInit(){}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-result-view-list"]],decls:6,vars:1,consts:[["infoModal",""],["mode","ios"],["button","",3,"lines"],["lines","none"],["button","",3,"click","lines"],["slot","start",3,"color","name"],["slot","end"],["slot","start","name","calendar-clear-outline","color","medium"],[1,"no-data"]],template:function(t,n){t&1&&(a(0,"ion-list",1),ke(1,cn,8,12,"ion-item",2,Se,!1,pn,5,3,"ion-item",3),l(),v(4,"app-result-date-info-modal",null,0)),t&2&&(s(),Pe(n.filteredDates()))},dependencies:[z,R,H,ce,J,pe,se,B,fe,ft],styles:["ion-list[_ngcontent-%COMP%]{background:var(--ion-color-light, #f4f5f8);border-radius:.5rem;padding-block:.25rem}ion-item[_ngcontent-%COMP%]{--background: transparent}.no-data[_ngcontent-%COMP%]{font-size:.9rem;line-height:.9rem}"]});let o=i;return o})();var Si={Results:{en:"Results",ru:"\u0420\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u044B"},Vote:{en:"Vote",ru:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0434\u0430\u0442\u044B"}};function mn(o,i){o&1&&v(0,"app-result-view-list")}function dn(o,i){o&1&&v(0,"app-result-view-calendar")}var xs=(()=>{let i=class i{constructor(){this.eventId=k.required(),this.mainInfoComponent=Le(ut),this.alreadyInit=!1,this.ViewPick=Z,this.VotePageLocalize=Si}ionViewWillEnter(){this.alreadyInit?this.mainInfoComponent()?.refresh():this.alreadyInit=!0}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=I({type:i,selectors:[["app-vote-event-page"]],viewQuery:function(t,n){t&1&&Te(n.mainInfoComponent,ut,5),t&2&&Ve()},hostAttrs:[1,"app-page-inner"],inputs:{eventId:[1,"eventId"]},decls:29,vars:25,consts:[["eventMainInfo",""],["filters",""],["viewPicker",""],["resLoading","appFeatureLoad","result","appResultView"],[1,"ion-padding"],["appFeatureLoad","",3,"eventId"],["mode","ios","value","vote"],["value","info","contentId","info"],["value","vote","contentId","vote"],["mode","ios"],["id","info"],[1,"segment-view-content"],[3,"disabled","maxMembers","maxOverlap"],[3,"refresh","disabled"],["appFeatureLoad","","placeholderOpacity","0.5","appResultView","",3,"viewPick","eventId","min","maybe","time","trimPast"],["id","vote"],["appFeatureLoad","","placeholderOpacity","0.5",3,"voteUpdated","eventId","minDate","maxDate"]],template:function(t,n){if(t&1){let c=S();a(0,"ion-content",4),v(1,"app-event-main-info",5,0),a(3,"ion-segment",6)(4,"ion-segment-button",7)(5,"ion-label"),d(6),p(7,"localize"),l()(),a(8,"ion-segment-button",8)(9,"ion-label"),d(10),p(11,"localize"),l()()(),a(12,"ion-segment-view",9)(13,"ion-segment-content",10)(14,"div",11),v(15,"app-result-filters",12,1),p(17,"async"),a(18,"app-result-view-picker-control",13,2),p(20,"async"),C("refresh",function(){b(c);let _=M(23);return x(_.refresh())}),l(),a(21,"app-result-view-picker-container",14,3),U(24,mn,1,0,"app-result-view-list")(25,dn,1,0,"app-result-view-calendar"),l()()(),a(26,"ion-segment-content",15)(27,"div",11)(28,"app-vote-calendar",16),C("voteUpdated",function(){b(c);let _=M(23);return x(_.refresh())}),l()()()()()}if(t&2){let c,m,_=M(2),L=M(16),Ae=M(19),Ge=M(22),ki=M(23);s(),u("eventId",n.eventId());let ye=_.info();s(5),g(" ",f(7,17,n.VotePageLocalize.Results)," "),s(4),g(" ",f(11,19,n.VotePageLocalize.Vote)," "),s(5),u("disabled",f(17,21,Ge.loading$))("maxMembers",(ye==null||ye.users==null?null:ye.users.length)??0)("maxOverlap",(c=ki.info())==null?null:c.maxOverlap),s(3),u("disabled",f(20,23,Ge.loading$)),s(3),u("viewPick",Ae.value())("eventId",n.eventId())("min",L.membersCount())("maybe",L.maybe())("time",L.time())("trimPast",L.trimPast()),s(3),N((m=Ae.value())===n.ViewPick.List?24:m===n.ViewPick.Calendar?25:-1),s(4),u("eventId",n.eventId())("minDate",ye==null?null:ye.starts)("maxDate",ye==null?null:ye.ends)}},dependencies:[ri,Yt,R,G,B,vi,ut,ui,yi,bi,Ii,wi,_e,ti,Gt,Jt,Xt,he],styles:["ion-segment[_ngcontent-%COMP%]{margin:1rem 0 .5rem;background:var(--ion-color-light, #f4f5f8)}ion-segment-view[_ngcontent-%COMP%]{height:auto}.segment-view-content[_ngcontent-%COMP%]{padding:.25rem .75rem 1.25rem;display:flex;flex-direction:column;gap:.75rem}"]});let o=i;return o})();export{xs as VoteEventPageComponent};
