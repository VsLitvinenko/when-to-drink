import{a as Me,c as j}from"./chunk-6IGCFAUU.js";import{b as ye,c as R,d as G,e as L,g as Pe,h as ke}from"./chunk-HYIEL7JN.js";import{$a as oe,Bb as T,C as c,D as _,E,Ea as U,Eb as ue,Fb as ve,Ga as d,Ha as p,Hb as he,Ib as fe,Jb as ge,M as a,Ma as te,Ob as _e,P as F,Pa as w,T as b,Ta as ie,Ub as Ee,Va as ne,Vb as z,Wb as Ce,Y as Z,Z as ee,_b as be,a as N,ba as u,bc as V,ca as r,cb as re,cc as Ie,da as s,e as A,ea as l,eb as D,f as Q,h as $,ia as S,ja as C,jb as O,ka as g,kb as ae,l as J,lb as se,mb as le,n as k,nb as y,pb as de,qb as pe,s as K,sa as I,sb as me,u as M,ua as x,v as X,va as v,vb as ce,w as q,wa as h,z as Y}from"./chunk-FOWV4JTP.js";import"./chunk-Q6FFIHTR.js";import"./chunk-7KGURMOZ.js";import"./chunk-NKG53MNX.js";import"./chunk-62TPDNO2.js";import"./chunk-7PWDY3UP.js";import"./chunk-JRYKI6H5.js";import"./chunk-GIIU5PV3.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-SPMQWSIB.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import"./chunk-2R6CW7ES.js";var H={Name:{en:"Event name",ru:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},Starts:{en:"Starts",ru:"\u041D\u0430\u0447\u0430\u043B\u043E"},Ends:{en:"Ends",ru:"\u041A\u043E\u043D\u0435\u0446"},Description:{en:"Description",ru:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"},NamePlaceholder:{en:"Enter name",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"},DescriptionPlaceholder:{en:"Enter description",ru:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435"},CreateEvent:{en:"Create event",ru:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u0435"},UpdateEvent:{en:"Update event",ru:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u043E\u0431\u044B\u0442\u0438\u0435"},HasBeenSaved:{en:"All changes have been saved successfully",ru:"\u0412\u0441\u0435 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u044B"}};var Se=(()=>{let i=class i{constructor(){this.baseUrl="events",this.http=c(oe)}getEventInfo(e){return this.http.get(`${this.baseUrl}/${e}`)}createEvent(e){return this.http.post(this.baseUrl,e).pipe($(t=>t.id))}updateEvent(e,t){return this.http.patch(`${this.baseUrl}/${e}`,t).pipe($(o=>o.id))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=Y({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var xe=()=>[0,1];function ze(n,i){if(n&1&&(l(0,"ion-datetime",13),d(1,"async")),n&2){let m=g();u("firstDayOfWeek",1)("locale",p(1,2,m.localizeFormat$))}}function Ve(n,i){if(n&1&&(l(0,"ion-datetime",14),d(1,"async")),n&2){let m=g();u("firstDayOfWeek",1)("locale",p(1,2,m.localizeFormat$))}}function Ge(n,i){n&1&&l(0,"ion-spinner",11)}function Le(n,i){if(n&1&&l(0,"ion-icon",12),n&2){let m=g();u("name",m.eventId()?"checkmark-outline":"add-outline")}}var we=(()=>{let i=class i{constructor(){this.eventId=w(),this.startVal=j(new Date,"yyyy-MM-dd"),this.endVal=j(Me(new Date,1),"yyyy-MM-dd"),this.eventFormGroup=new le({name:new y("",O.required),starts:new y(this.startVal,O.required),ends:new y(this.endVal,O.required),description:new y("")}),this.startDate=R(this.eventFormGroup.controls.starts.valueChanges,{initialValue:this.startVal}),this.endDate=R(this.eventFormGroup.controls.ends.valueChanges,{initialValue:this.endVal}),this.isDatesInvalid=te(()=>{let e=new Date(this.startDate()),t=new Date(this.endDate());return e>=t}),this.local=c(G),this.localizeFormat$=this.local.localizationWithFormat$,this.EditEventFormLocalize=H,this.router=c(D),this.activatedRoute=c(re),this.toast=c(V),this.request=c(Se),this.loading$=new N,this.eventInfo$=ye(this.eventId).pipe(q(()=>this.eventFormGroup.disable()),M(e=>e?this.request.getEventInfo(e):Q(null)),q(()=>this.eventFormGroup.enable()),K(1)),this.destroyed$=new N}ngOnInit(){this.eventInfo$.pipe(J(e=>e!==null),X(this.destroyed$)).subscribe(e=>{this.eventFormGroup.patchValue({name:e.name,starts:e.starts,ends:e.ends,description:e.description})})}ngOnDestroy(){this.destroyed$.next(void 0),this.destroyed$.complete()}saveChanges(){let e=this.eventId(),t=this.eventFormGroup.getRawValue(),o=e?this.request.updateEvent(e,t):this.request.createEvent(t);this.eventFormGroup.disable(),o.pipe(k(1)).subscribe(f=>{this.eventFormGroup.enable();let P=this.local.localizeSync(H.HasBeenSaved);this.toast.info(P,"cloud-done-outline"),this.updateIdQueryParam(f)})}updateIdQueryParam(e){let t={queryParams:{eventId:e},relativeTo:this.activatedRoute,queryParamsHandling:"merge"};this.router.navigate([],t)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=F({type:i,selectors:[["app-edit-event-form"]],inputs:{eventId:[1,"eventId"]},decls:35,vars:35,consts:[["startDateModal",""],["endDateModal",""],["mode","ios",3,"formGroup"],["color","dark","slot","end","formControlName","name",3,"placeholder"],[3,"click"],["datetime","datetimeStart"],[1,"event-datetime-modal",3,"keepContentsMounted","initialBreakpoint","breakpoints"],["datetime","datetimeEnd"],["lines","none",1,"notes-item"],["color","dark","slot","end","formControlName","description",3,"autoGrow","placeholder"],["mode","ios","expand","block",1,"save-changes-button",3,"click","disabled"],["mode","ios","slot","start"],["slot","start",3,"name"],["id","datetimeStart","formControlName","starts","presentation","date","mode","ios",3,"firstDayOfWeek","locale"],["id","datetimeEnd","formControlName","ends","presentation","date","mode","ios",3,"firstDayOfWeek","locale"]],template:function(t,o){if(t&1){let f=S();r(0,"ion-list",2)(1,"ion-item")(2,"ion-label"),v(3),d(4,"localize"),s(),l(5,"ion-input",3),d(6,"localize"),s(),r(7,"ion-item",4),C("click",function(){_(f);let B=I(13);return E(B.present())}),r(8,"ion-label"),v(9),d(10,"localize"),s(),l(11,"ion-datetime-button",5),r(12,"ion-modal",6,0),b(14,ze,2,4,"ng-template"),s()(),r(15,"ion-item",4),C("click",function(){_(f);let B=I(21);return E(B.present())}),r(16,"ion-label"),v(17),d(18,"localize"),s(),l(19,"ion-datetime-button",7),r(20,"ion-modal",6,1),b(22,Ve,2,4,"ng-template"),s()(),r(23,"ion-item",8)(24,"ion-label"),v(25),d(26,"localize"),s(),l(27,"ion-textarea",9),d(28,"localize"),s()(),r(29,"ion-button",10),C("click",function(){return _(f),E(o.saveChanges())}),Z(30,Ge,1,0,"ion-spinner",11)(31,Le,1,1,"ion-icon",12),r(32,"ion-label"),v(33),d(34,"localize"),s()()}if(t&2){let f=o.eventFormGroup.disabled;x("form-disabled",f),u("formGroup",o.eventFormGroup),a(3),h(" ",p(4,19,o.EditEventFormLocalize.Name)," "),a(2),u("placeholder",p(6,21,o.EditEventFormLocalize.NamePlaceholder)),a(4),h(" ",p(10,23,o.EditEventFormLocalize.Starts)," "),a(3),u("keepContentsMounted",!0)("initialBreakpoint",1)("breakpoints",U(33,xe)),a(5),h(" ",p(18,25,o.EditEventFormLocalize.Ends)," "),a(3),u("keepContentsMounted",!0)("initialBreakpoint",1)("breakpoints",U(34,xe)),a(5),h(" ",p(26,27,o.EditEventFormLocalize.Description)," "),a(2),u("autoGrow",!0)("placeholder",p(28,29,o.EditEventFormLocalize.DescriptionPlaceholder)),a(2),u("disabled",f||o.eventFormGroup.invalid||o.isDatesInvalid()),a(),ee(f?30:31),a(3),h(" ",p(34,31,o.eventId()?o.EditEventFormLocalize.UpdateEvent:o.EditEventFormLocalize.CreateEvent)," ")}},dependencies:[ke,fe,T,z,ge,he,ne,L,Ce,ce,Ee,ve,be,_e,me,ae,se,de,pe],styles:["ion-list[_ngcontent-%COMP%]{background:transparent}.form-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .form-disabled[_ngcontent-%COMP%]   ion-datetime-button[_ngcontent-%COMP%]{opacity:.5!important}ion-item[_ngcontent-%COMP%]{--background: transparent}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:1.25rem .5rem 1.25rem 0}ion-textarea[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%]{text-align:end;margin-right:.25rem;width:60%!important}.notes-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:auto}.notes-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{margin-top:.6rem}.save-changes-button[_ngcontent-%COMP%]{margin:.5rem 1rem}.save-changes-button[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-left:-.25rem;margin-inline-end:.5rem}.save-changes-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:1.75rem;height:1.75rem;margin-inline-end:.5rem}.save-changes-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{line-height:1.75rem}  .event-datetime-modal .ion-delegate-host{padding:.75rem .25rem 2.5rem!important;background-color:var(--ion-color-light, #f4f5f8)!important}"]});let n=i;return n})();var W={Link:{en:"Link",ru:"\u0421\u0441\u044B\u043B\u043A\u0430"},Share:{en:"Share",ru:"\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F"},GoTo:{en:"Go to",ru:"\u041F\u0435\u0440\u0435\u0439\u0442\u0438"},ClipboardLink:{en:"Link to event was copied to clipboard",ru:"\u0421\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0441\u043E\u0431\u044B\u0442\u0438\u0435 \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430"}};function Be(n,i){if(n&1){let m=S();r(0,"div",4)(1,"ion-button",5),C("click",function(){_(m);let t=g();return E(t.copyToClipboard())}),l(2,"ion-icon",6),r(3,"span"),v(4),d(5,"localize"),s()(),r(6,"ion-button",5),C("click",function(){_(m);let t=g();return E(t.share())}),l(7,"ion-icon",7),r(8,"span"),v(9),d(10,"localize"),s()(),r(11,"ion-button",5),C("click",function(){_(m);let t=g();return E(t.redirectToEvent())}),l(12,"ion-icon",8),r(13,"span"),v(14),d(15,"localize"),s()()()}if(n&2){let m=g(),e=I(2);x("disabled",e.eventFormGroup.disabled),a(4),h(" ",p(5,5,m.EditEventPageLocalize.Link)," "),a(5),h(" ",p(10,7,m.EditEventPageLocalize.Share)," "),a(5),h(" ",p(15,9,m.EditEventPageLocalize.GoTo)," ")}}var Et=(()=>{let i=class i{constructor(){this.eventId=w(),this.router=c(D),this.toast=c(V),this.tg=c(Ie),this.local=c(G),this.EditEventPageLocalize=W}copyToClipboard(){this.tg.getEventTgLink(this.eventId()).pipe(M(e=>A(navigator.clipboard.writeText(e))),k(1)).subscribe(()=>{let e=this.local.localizeSync(W.ClipboardLink);this.toast.light(e,"clipboard-outline")})}share(){this.eventId()&&this.tg.shareEvent(this.eventId())}redirectToEvent(){this.router.navigate(["vote",this.eventId()])}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=F({type:i,selectors:[["app-edit-event-page"]],hostAttrs:[1,"app-page-inner"],inputs:{eventId:[1,"eventId"]},decls:4,vars:2,consts:[["form",""],[1,"ion-padding"],[3,"eventId"],["class","done-actions",3,"disabled",4,"ngIf"],[1,"done-actions"],["mode","ios","size","small","color","light",3,"click"],["name","link-outline","slot","start"],["name","arrow-redo-outline","slot","start"],["name","arrow-forward","slot","end"]],template:function(t,o){t&1&&(r(0,"ion-content",1),l(1,"app-edit-event-form",2,0),b(3,Be,16,11,"div",3),s()),t&2&&(a(),u("eventId",o.eventId()),a(2),u("ngIf",o.eventId()))},dependencies:[Pe,ie,ue,z,L,we,T],styles:[".done-actions[_ngcontent-%COMP%]{margin:.5rem .925rem;display:flex;flex-wrap:wrap;justify-content:space-between;gap:.5rem}.done-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex-grow:1;--padding-top: .6rem;--padding-bottom: .6rem;--border-radius: .75rem}.done-actions.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}"]});let n=i;return n})();export{Et as EditEventPageComponent};
